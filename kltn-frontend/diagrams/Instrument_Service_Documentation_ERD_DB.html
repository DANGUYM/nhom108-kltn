<!DOCTYPE html><html><head>
      <title>Instrument_Service_Documentation_ERD_DB</title>
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width, initial-scale=1.0">
      
      <link rel="stylesheet" href="file:///c:\Users\Da Nguym\.vscode\extensions\shd101wyy.markdown-preview-enhanced-0.8.19\crossnote\dependencies\katex\katex.min.css">
      
      
      
      
      
      <style>
      code[class*=language-],pre[class*=language-]{color:#333;background:0 0;font-family:Consolas,"Liberation Mono",Menlo,Courier,monospace;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.4;-moz-tab-size:8;-o-tab-size:8;tab-size:8;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none}pre[class*=language-]{padding:.8em;overflow:auto;border-radius:3px;background:#f5f5f5}:not(pre)>code[class*=language-]{padding:.1em;border-radius:.3em;white-space:normal;background:#f5f5f5}.token.blockquote,.token.comment{color:#969896}.token.cdata{color:#183691}.token.doctype,.token.macro.property,.token.punctuation,.token.variable{color:#333}.token.builtin,.token.important,.token.keyword,.token.operator,.token.rule{color:#a71d5d}.token.attr-value,.token.regex,.token.string,.token.url{color:#183691}.token.atrule,.token.boolean,.token.code,.token.command,.token.constant,.token.entity,.token.number,.token.property,.token.symbol{color:#0086b3}.token.prolog,.token.selector,.token.tag{color:#63a35c}.token.attr-name,.token.class,.token.class-name,.token.function,.token.id,.token.namespace,.token.pseudo-class,.token.pseudo-element,.token.url-reference .token.variable{color:#795da3}.token.entity{cursor:help}.token.title,.token.title .token.punctuation{font-weight:700;color:#1d3e81}.token.list{color:#ed6a43}.token.inserted{background-color:#eaffea;color:#55a532}.token.deleted{background-color:#ffecec;color:#bd2c00}.token.bold{font-weight:700}.token.italic{font-style:italic}.language-json .token.property{color:#183691}.language-markup .token.tag .token.punctuation{color:#333}.language-css .token.function,code.language-css{color:#0086b3}.language-yaml .token.atrule{color:#63a35c}code.language-yaml{color:#183691}.language-ruby .token.function{color:#333}.language-markdown .token.url{color:#795da3}.language-makefile .token.symbol{color:#795da3}.language-makefile .token.variable{color:#183691}.language-makefile .token.builtin{color:#0086b3}.language-bash .token.keyword{color:#0086b3}pre[data-line]{position:relative;padding:1em 0 1em 3em}pre[data-line] .line-highlight-wrapper{position:absolute;top:0;left:0;background-color:transparent;display:block;width:100%}pre[data-line] .line-highlight{position:absolute;left:0;right:0;padding:inherit 0;margin-top:1em;background:hsla(24,20%,50%,.08);background:linear-gradient(to right,hsla(24,20%,50%,.1) 70%,hsla(24,20%,50%,0));pointer-events:none;line-height:inherit;white-space:pre}pre[data-line] .line-highlight:before,pre[data-line] .line-highlight[data-end]:after{content:attr(data-start);position:absolute;top:.4em;left:.6em;min-width:1em;padding:0 .5em;background-color:hsla(24,20%,50%,.4);color:#f4f1ef;font:bold 65%/1.5 sans-serif;text-align:center;vertical-align:.3em;border-radius:999px;text-shadow:none;box-shadow:0 1px #fff}pre[data-line] .line-highlight[data-end]:after{content:attr(data-end);top:auto;bottom:.4em}html body{font-family:'Helvetica Neue',Helvetica,'Segoe UI',Arial,freesans,sans-serif;font-size:16px;line-height:1.6;color:#333;background-color:#fff;overflow:initial;box-sizing:border-box;word-wrap:break-word}html body>:first-child{margin-top:0}html body h1,html body h2,html body h3,html body h4,html body h5,html body h6{line-height:1.2;margin-top:1em;margin-bottom:16px;color:#000}html body h1{font-size:2.25em;font-weight:300;padding-bottom:.3em}html body h2{font-size:1.75em;font-weight:400;padding-bottom:.3em}html body h3{font-size:1.5em;font-weight:500}html body h4{font-size:1.25em;font-weight:600}html body h5{font-size:1.1em;font-weight:600}html body h6{font-size:1em;font-weight:600}html body h1,html body h2,html body h3,html body h4,html body h5{font-weight:600}html body h5{font-size:1em}html body h6{color:#5c5c5c}html body strong{color:#000}html body del{color:#5c5c5c}html body a:not([href]){color:inherit;text-decoration:none}html body a{color:#08c;text-decoration:none}html body a:hover{color:#00a3f5;text-decoration:none}html body img{max-width:100%}html body>p{margin-top:0;margin-bottom:16px;word-wrap:break-word}html body>ol,html body>ul{margin-bottom:16px}html body ol,html body ul{padding-left:2em}html body ol.no-list,html body ul.no-list{padding:0;list-style-type:none}html body ol ol,html body ol ul,html body ul ol,html body ul ul{margin-top:0;margin-bottom:0}html body li{margin-bottom:0}html body li.task-list-item{list-style:none}html body li>p{margin-top:0;margin-bottom:0}html body .task-list-item-checkbox{margin:0 .2em .25em -1.8em;vertical-align:middle}html body .task-list-item-checkbox:hover{cursor:pointer}html body blockquote{margin:16px 0;font-size:inherit;padding:0 15px;color:#5c5c5c;background-color:#f0f0f0;border-left:4px solid #d6d6d6}html body blockquote>:first-child{margin-top:0}html body blockquote>:last-child{margin-bottom:0}html body hr{height:4px;margin:32px 0;background-color:#d6d6d6;border:0 none}html body table{margin:10px 0 15px 0;border-collapse:collapse;border-spacing:0;display:block;width:100%;overflow:auto;word-break:normal;word-break:keep-all}html body table th{font-weight:700;color:#000}html body table td,html body table th{border:1px solid #d6d6d6;padding:6px 13px}html body dl{padding:0}html body dl dt{padding:0;margin-top:16px;font-size:1em;font-style:italic;font-weight:700}html body dl dd{padding:0 16px;margin-bottom:16px}html body code{font-family:Menlo,Monaco,Consolas,'Courier New',monospace;font-size:.85em;color:#000;background-color:#f0f0f0;border-radius:3px;padding:.2em 0}html body code::after,html body code::before{letter-spacing:-.2em;content:'\00a0'}html body pre>code{padding:0;margin:0;word-break:normal;white-space:pre;background:0 0;border:0}html body .highlight{margin-bottom:16px}html body .highlight pre,html body pre{padding:1em;overflow:auto;line-height:1.45;border:#d6d6d6;border-radius:3px}html body .highlight pre{margin-bottom:0;word-break:normal}html body pre code,html body pre tt{display:inline;max-width:initial;padding:0;margin:0;overflow:initial;line-height:inherit;word-wrap:normal;background-color:transparent;border:0}html body pre code:after,html body pre code:before,html body pre tt:after,html body pre tt:before{content:normal}html body blockquote,html body dl,html body ol,html body p,html body pre,html body ul{margin-top:0;margin-bottom:16px}html body kbd{color:#000;border:1px solid #d6d6d6;border-bottom:2px solid #c7c7c7;padding:2px 4px;background-color:#f0f0f0;border-radius:3px}@media print{html body{background-color:#fff}html body h1,html body h2,html body h3,html body h4,html body h5,html body h6{color:#000;page-break-after:avoid}html body blockquote{color:#5c5c5c}html body pre{page-break-inside:avoid}html body table{display:table}html body img{display:block;max-width:100%;max-height:100%}html body code,html body pre{word-wrap:break-word;white-space:pre}}.markdown-preview{width:100%;height:100%;box-sizing:border-box}.markdown-preview ul{list-style:disc}.markdown-preview ul ul{list-style:circle}.markdown-preview ul ul ul{list-style:square}.markdown-preview ol{list-style:decimal}.markdown-preview ol ol,.markdown-preview ul ol{list-style-type:lower-roman}.markdown-preview ol ol ol,.markdown-preview ol ul ol,.markdown-preview ul ol ol,.markdown-preview ul ul ol{list-style-type:lower-alpha}.markdown-preview .newpage,.markdown-preview .pagebreak{page-break-before:always}.markdown-preview pre.line-numbers{position:relative;padding-left:3.8em;counter-reset:linenumber}.markdown-preview pre.line-numbers>code{position:relative}.markdown-preview pre.line-numbers .line-numbers-rows{position:absolute;pointer-events:none;top:1em;font-size:100%;left:0;width:3em;letter-spacing:-1px;border-right:1px solid #999;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}.markdown-preview pre.line-numbers .line-numbers-rows>span{pointer-events:none;display:block;counter-increment:linenumber}.markdown-preview pre.line-numbers .line-numbers-rows>span:before{content:counter(linenumber);color:#999;display:block;padding-right:.8em;text-align:right}.markdown-preview .mathjax-exps .MathJax_Display{text-align:center!important}.markdown-preview:not([data-for=preview]) .code-chunk .code-chunk-btn-group{display:none}.markdown-preview:not([data-for=preview]) .code-chunk .status{display:none}.markdown-preview:not([data-for=preview]) .code-chunk .output-div{margin-bottom:16px}.markdown-preview .md-toc{padding:0}.markdown-preview .md-toc .md-toc-link-wrapper .md-toc-link{display:inline;padding:.25rem 0}.markdown-preview .md-toc .md-toc-link-wrapper .md-toc-link div,.markdown-preview .md-toc .md-toc-link-wrapper .md-toc-link p{display:inline}.markdown-preview .md-toc .md-toc-link-wrapper.highlighted .md-toc-link{font-weight:800}.scrollbar-style::-webkit-scrollbar{width:8px}.scrollbar-style::-webkit-scrollbar-track{border-radius:10px;background-color:transparent}.scrollbar-style::-webkit-scrollbar-thumb{border-radius:5px;background-color:rgba(150,150,150,.66);border:4px solid rgba(150,150,150,.66);background-clip:content-box}html body[for=html-export]:not([data-presentation-mode]){position:relative;width:100%;height:100%;top:0;left:0;margin:0;padding:0;overflow:auto}html body[for=html-export]:not([data-presentation-mode]) .markdown-preview{position:relative;top:0;min-height:100vh}@media screen and (min-width:914px){html body[for=html-export]:not([data-presentation-mode]) .markdown-preview{padding:2em calc(50% - 457px + 2em)}}@media screen and (max-width:914px){html body[for=html-export]:not([data-presentation-mode]) .markdown-preview{padding:2em}}@media screen and (max-width:450px){html body[for=html-export]:not([data-presentation-mode]) .markdown-preview{font-size:14px!important;padding:1em}}@media print{html body[for=html-export]:not([data-presentation-mode]) #sidebar-toc-btn{display:none}}html body[for=html-export]:not([data-presentation-mode]) #sidebar-toc-btn{position:fixed;bottom:8px;left:8px;font-size:28px;cursor:pointer;color:inherit;z-index:99;width:32px;text-align:center;opacity:.4}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] #sidebar-toc-btn{opacity:1}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc{position:fixed;top:0;left:0;width:300px;height:100%;padding:32px 0 48px 0;font-size:14px;box-shadow:0 0 4px rgba(150,150,150,.33);box-sizing:border-box;overflow:auto;background-color:inherit}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc::-webkit-scrollbar{width:8px}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc::-webkit-scrollbar-track{border-radius:10px;background-color:transparent}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc::-webkit-scrollbar-thumb{border-radius:5px;background-color:rgba(150,150,150,.66);border:4px solid rgba(150,150,150,.66);background-clip:content-box}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc a{text-decoration:none}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc .md-toc{padding:0 16px}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc .md-toc .md-toc-link-wrapper .md-toc-link{display:inline;padding:.25rem 0}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc .md-toc .md-toc-link-wrapper .md-toc-link div,html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc .md-toc .md-toc-link-wrapper .md-toc-link p{display:inline}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .md-sidebar-toc .md-toc .md-toc-link-wrapper.highlighted .md-toc-link{font-weight:800}html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .markdown-preview{left:300px;width:calc(100% - 300px);padding:2em calc(50% - 457px - 300px / 2);margin:0;box-sizing:border-box}@media screen and (max-width:1274px){html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .markdown-preview{padding:2em}}@media screen and (max-width:450px){html body[for=html-export]:not([data-presentation-mode])[html-show-sidebar-toc] .markdown-preview{width:100%}}html body[for=html-export]:not([data-presentation-mode]):not([html-show-sidebar-toc]) .markdown-preview{left:50%;transform:translateX(-50%)}html body[for=html-export]:not([data-presentation-mode]):not([html-show-sidebar-toc]) .md-sidebar-toc{display:none}
/* Please visit the URL below for more information: */
/*   https://shd101wyy.github.io/markdown-preview-enhanced/#/customize-css */

      </style>
      <!-- The content below will be included at the end of the <head> element. --><script type="text/javascript">
  document.addEventListener("DOMContentLoaded", function () {
    // your code here
  });
</script></head><body for="html-export">
    
    
      <div class="crossnote markdown-preview  ">
      
<h1 id="erd-and-schema-for-instrument-service">ERD and Schema for Instrument Service </h1>
<p><img src="image.png" alt="alt text"></p>
<h2 id="-m·ª•c-l·ª•c">üìã M·ª•c L·ª•c </h2>
<ol>
<li><a href="#1-t%E1%BB%95ng-quan">T·ªïng quan</a></li>
<li><a href="#2-core-entities-collection-1-3">Core Entities (Collection 1-3)</a>
<ul>
<li>2.1 <a href="#21-collection-1-instrument_model">Collection 1: Instrument_Model</a></li>
<li>2.2 <a href="#22-collection-2-instrument">Collection 2: Instrument</a></li>
<li>2.3 <a href="#23-collection-3-instrument_mode_change_log">Collection 3: Instrument_Mode_Change_Log</a></li>
</ul>
</li>
<li><a href="#3-test-results-management-collection-4-7">Test Results Management (Collection 4-7)</a>
<ul>
<li>3.1 <a href="#31-collection-4-raw_test_result">Collection 4: Raw_Test_Result</a></li>
<li>3.2 <a href="#32-collection-5-hl7_publish_log">Collection 5: HL7_Publish_Log</a></li>
<li>3.3 <a href="#33-collection-6-raw_result_deletion_log">Collection 6: Raw_Result_Deletion_Log</a></li>
<li>3.4 <a href="#34-collection-7-auto_test_order_creation">Collection 7: Auto_Test_Order_Creation</a></li>
</ul>
</li>
<li><a href="#4-reagents-management-collection-8-10">Reagents Management (Collection 8-10)</a>
<ul>
<li>4.1 <a href="#41-collection-8-reagent">Collection 8: Reagent</a></li>
<li>4.2 <a href="#42-collection-9-instrument_reagent">Collection 9: Instrument_Reagent</a></li>
<li>4.3 <a href="#43-collection-10-reagent_activity_log">Collection 10: Reagent_Activity_Log</a></li>
</ul>
</li>
<li><a href="#5-configuration-management-collection-11-12">Configuration Management (Collection 11-12)</a>
<ul>
<li>5.1 <a href="#51-collection-11-configuration_profile">Collection 11: Configuration_Profile</a></li>
<li>5.2 <a href="#52-collection-12-configuration_sync_log">Collection 12: Configuration_Sync_Log</a></li>
</ul>
</li>
<li><a href="#6-relationships--business-rules">Relationships &amp; Business Rules</a></li>
</ol>
<hr>
<h2 id="1-t·ªïng-quan">1. T·ªïng quan </h2>
<p>S∆° ƒë·ªì ERD (Entity Relationship Diagram) n√†y m√¥ t·∫£ c·∫•u tr√∫c c∆° s·ªü d·ªØ li·ªáu MongoDB cho <strong>Instrument Service</strong> - m·ªôt th√†nh ph·∫ßn quan tr·ªçng trong h·ªá th·ªëng Qu·∫£n l√Ω Ph√≤ng th√≠ nghi·ªám (Laboratory Management System). D·ªãch v·ª• n√†y qu·∫£n l√Ω to√†n b·ªô quy tr√¨nh x√©t nghi·ªám thi·∫øt b·ªã, thu·ªëc th·ª≠ v√† c·∫•u h√¨nh cho c√°c thi·∫øt b·ªã ph√¢n t√≠ch huy·∫øt h·ªçc.</p>
<h3 id="Ô∏è-c·∫•u-tr√∫c-module-theo-erd---t·ªïng-quan-chi-ti·∫øt">üèóÔ∏è C·∫•u tr√∫c Module theo ERD - T·ªïng quan Chi ti·∫øt </h3>
<table>
<thead>
<tr>
<th>Module</th>
<th>Collections</th>
<th>Count</th>
<th>M√¥ t·∫£ chi ti·∫øt</th>
<th>L√Ω do nh√≥m</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>1. Core Entities<br>(Collection 1-3)</strong></td>
<td>‚Ä¢ <strong>Instrument_Model</strong>: ƒê·ªãnh nghƒ©a c√°c lo·∫°i thi·∫øt b·ªã<br>‚Ä¢ <strong>Instrument</strong>: Th√¥ng tin thi·∫øt b·ªã c·ª• th·ªÉ<br>‚Ä¢ <strong>Instrument_Mode_Change_Log</strong>: Audit log thay ƒë·ªïi mode</td>
<td><strong>3</strong></td>
<td><strong>Qu·∫£n l√Ω thi·∫øt b·ªã v·∫≠t l√Ω v√† audit trail</strong><br>- Master data c√°c model thi·∫øt b·ªã<br>- Th√¥ng tin runtime c·ªßa t·ª´ng thi·∫øt b·ªã<br>- Truy v·∫øt m·ªçi thay ƒë·ªïi tr·∫°ng th√°i</td>
<td>Entities c·ªët l√µi v·ªÅ <strong>thi·∫øt b·ªã v·∫≠t l√Ω</strong> v√† audit trail c·ªßa ch√∫ng</td>
</tr>
<tr>
<td><strong>2. Test Results Management<br>(Collection 4-7)</strong></td>
<td>‚Ä¢ <strong>Raw_Test_Result</strong>: K·∫øt qu·∫£ x√©t nghi·ªám th√¥<br>‚Ä¢ <strong>HL7_Publish_Log</strong>: Log vi·ªác publish k·∫øt qu·∫£<br>‚Ä¢ <strong>Raw_Result_Deletion_Log</strong>: Audit vi·ªác x√≥a k·∫øt qu·∫£<br>‚Ä¢ <strong>Auto_Test_Order_Creation</strong>: T·ª± ƒë·ªông t·∫°o test order</td>
<td><strong>4</strong></td>
<td><strong>To√†n b·ªô lifecycle k·∫øt qu·∫£ x√©t nghi·ªám</strong><br>- L∆∞u tr·ªØ k·∫øt qu·∫£ th√¥ t·ª´ thi·∫øt b·ªã<br>- Theo d√µi vi·ªác publish sang services kh√°c<br>- Audit vi·ªác x√≥a data (compliance)<br>- T·ª± ƒë·ªông t·∫°o order khi thi·∫øu</td>
<td>T·∫•t c·∫£ li√™n quan ƒë·∫øn <strong>lifecycle c·ªßa k·∫øt qu·∫£ x√©t nghi·ªám</strong> - t·ª´ t·∫°o, publish, ƒë·∫øn x√≥a v√† auto-creation</td>
</tr>
<tr>
<td><strong>3. Reagents Management<br>(Collection 8-10)</strong></td>
<td>‚Ä¢ <strong>Reagent</strong>: Th√¥ng tin thu·ªëc th·ª≠<br>‚Ä¢ <strong>Instrument_Reagent</strong>: G√°n thu·ªëc th·ª≠ cho thi·∫øt b·ªã<br>‚Ä¢ <strong>Reagent_Activity_Log</strong>: Audit ho·∫°t ƒë·ªông thu·ªëc th·ª≠</td>
<td><strong>3</strong></td>
<td><strong>Qu·∫£n l√Ω to√†n b·ªô lifecycle thu·ªëc th·ª≠</strong><br>- Inventory v√† th√¥ng tin thu·ªëc th·ª≠<br>- Assignment thu·ªëc th·ª≠ cho t·ª´ng thi·∫øt b·ªã<br>- Tracking usage v√† c√°c ho·∫°t ƒë·ªông</td>
<td>Qu·∫£n l√Ω to√†n b·ªô <strong>lifecycle thu·ªëc th·ª≠</strong> - t·ª´ inventory, assignment ƒë·∫øn usage tracking</td>
</tr>
<tr>
<td><strong>4. Configuration Management<br>(Collection 11-12)</strong></td>
<td>‚Ä¢ <strong>Configuration_Profile</strong>: C√°c profile c·∫•u h√¨nh<br>‚Ä¢ <strong>Configuration_Sync_Log</strong>: Log vi·ªác sync c·∫•u h√¨nh</td>
<td><strong>2</strong></td>
<td><strong>C·∫•u h√¨nh h·ªá th·ªëng v√† audit ƒë·ªìng b·ªô</strong><br>- Templates c·∫•u h√¨nh cho c√°c lo·∫°i thi·∫øt b·ªã<br>- Theo d√µi vi·ªác apply c·∫•u h√¨nh<br>- Rollback v√† error handling</td>
<td>Qu·∫£n l√Ω <strong>c·∫•u h√¨nh h·ªá th·ªëng</strong> v√† audit trail c·ªßa vi·ªác √°p d·ª•ng c·∫•u h√¨nh</td>
</tr>
<tr>
<td><strong>üéØ Total</strong></td>
<td><strong>Complete Laboratory Workflow</strong></td>
<td><strong>12</strong></td>
<td><strong>End-to-end Laboratory Management</strong><br>Covering: Device ‚Üí Results ‚Üí Reagents ‚Üí Configuration</td>
<td><strong>Ki·∫øn tr√∫c Microservices</strong> - m·ªói module ƒë·ªôc l·∫≠p nh∆∞ng c√≥ integration points</td>
</tr>
</tbody>
</table>
<h3 id="-ki·∫øn-tr√∫c-microservices">üéØ Ki·∫øn tr√∫c Microservices </h3>
<p>C√°ch ph√¢n chia n√†y <strong>tu√¢n th·ªß ki·∫øn tr√∫c microservices</strong> - m·ªói service ch·ªâ qu·∫£n l√Ω domain c·ªßa m√¨nh:</p>
<ul>
<li><strong>Test_Order ƒë∆∞·ª£c qu·∫£n l√Ω b·ªüi Test Order Service</strong> (kh√¥ng store trong Instrument Service)</li>
<li><strong>Instrument Service</strong> ch·ªâ reference Test_Order_ID v√† t·ª± ƒë·ªông t·∫°o order khi c·∫ßn thi·∫øt</li>
<li><strong>Clear separation of concerns</strong> cho t·ª´ng functional domain</li>
</ul>
<hr>
<h2 id="2-core-entities-collection-1-3">2. Core Entities (Collection 1-3) </h2>
<h3 id="21--collection-1-instrument_model-collection-instrument_models">2.1 üìã Collection 1: Instrument_Model (Collection: <code>instrument_models</code>) </h3>
<p><strong>üéØ M·ª•c ƒë√≠ch</strong>: ƒê·ªãnh nghƒ©a c√°c lo·∫°i model thi·∫øt b·ªã v√† th√¥ng s·ªë k·ªπ thu·∫≠t chu·∫©n cho t·ª´ng model.</p>
<h4 id="schema-definition">Schema Definition </h4>
<table>
<thead>
<tr>
<th>Tr∆∞·ªùng</th>
<th>Ki·ªÉu d·ªØ li·ªáu</th>
<th>M√¥ t·∫£</th>
<th>Validation Rules</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Model_ID</strong></td>
<td>String (PK)</td>
<td>ID model thi·∫øt b·ªã</td>
<td>Auto-generated</td>
</tr>
<tr>
<td>Model_Name</td>
<td>String</td>
<td>T√™n model</td>
<td>Required, Max 100 chars</td>
</tr>
<tr>
<td>Manufacturer</td>
<td>String</td>
<td>Nh√† s·∫£n xu·∫•t</td>
<td>Required</td>
</tr>
<tr>
<td>Model_Version</td>
<td>String</td>
<td>Phi√™n b·∫£n model</td>
<td>Required</td>
</tr>
<tr>
<td>Supported_Test_Types</td>
<td>Array[String]</td>
<td>Lo·∫°i x√©t nghi·ªám h·ªó tr·ª£</td>
<td>Required, Min 1 item</td>
</tr>
<tr>
<td>Technical_Specifications</td>
<td>Object</td>
<td>Th√¥ng s·ªë k·ªπ thu·∫≠t</td>
<td>JSON format</td>
</tr>
<tr>
<td>Default_Configuration</td>
<td>Object</td>
<td>C·∫•u h√¨nh m·∫∑c ƒë·ªãnh</td>
<td>JSON format</td>
</tr>
<tr>
<td>Created_Date</td>
<td>DateTime</td>
<td>Ng√†y t·∫°o</td>
<td>Auto-generated</td>
</tr>
<tr>
<td>Updated_Date</td>
<td>DateTime</td>
<td>Ng√†y c·∫≠p nh·∫≠t</td>
<td>Auto-updated</td>
</tr>
</tbody>
</table>
<h4 id="-v√≠-d·ª•-document-complete">üìÑ V√≠ d·ª• Document Complete </h4>
<pre data-role="codeBlock" data-info="json" class="language-json json"><code><span class="token punctuation">{</span>
  <span class="token property">"_id"</span><span class="token operator">:</span> ObjectId(<span class="token string">"64f123456789abcdef012345"</span>)<span class="token punctuation">,</span>
  <span class="token property">"Model_ID"</span><span class="token operator">:</span> <span class="token string">"MDL_XN1000_SYSMEX_V1"</span><span class="token punctuation">,</span>
  <span class="token property">"Model_Name"</span><span class="token operator">:</span> <span class="token string">"XN-1000 Hematology Analyzer"</span><span class="token punctuation">,</span>
  <span class="token property">"Manufacturer"</span><span class="token operator">:</span> <span class="token string">"Sysmex Corporation"</span><span class="token punctuation">,</span>
  <span class="token property">"Model_Version"</span><span class="token operator">:</span> <span class="token string">"v2.1.0"</span><span class="token punctuation">,</span>
  <span class="token property">"Supported_Test_Types"</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token string">"CBC"</span><span class="token punctuation">,</span> <span class="token string">"CBC+Diff"</span><span class="token punctuation">,</span> <span class="token string">"Reticulocyte"</span><span class="token punctuation">,</span> <span class="token string">"Body Fluid"</span><span class="token punctuation">,</span> <span class="token string">"PLT-F"</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token property">"Technical_Specifications"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">"throughput"</span><span class="token operator">:</span> <span class="token string">"100 samples/hour"</span><span class="token punctuation">,</span>
    <span class="token property">"sample_volume"</span><span class="token operator">:</span> <span class="token string">"88ŒºL whole blood"</span><span class="token punctuation">,</span>
    <span class="token property">"measurement_parameters"</span><span class="token operator">:</span> <span class="token number">29</span><span class="token punctuation">,</span>
    <span class="token property">"measurement_methods"</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">"Flow Cytometry"</span><span class="token punctuation">,</span> <span class="token string">"Hydrodynamic Focusing"</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token property">"barcode_capability"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    <span class="token property">"connectivity"</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">"LIS"</span><span class="token punctuation">,</span> <span class="token string">"Middleware"</span><span class="token punctuation">,</span> <span class="token string">"HL7"</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token property">"Default_Configuration"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">"auto_sample_prep"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    <span class="token property">"auto_dilution"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    <span class="token property">"qc_frequency"</span><span class="token operator">:</span> <span class="token string">"daily"</span><span class="token punctuation">,</span>
    <span class="token property">"maintenance_interval"</span><span class="token operator">:</span> <span class="token string">"monthly"</span><span class="token punctuation">,</span>
    <span class="token property">"calibration_validity"</span><span class="token operator">:</span> <span class="token number">30</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token property">"Performance_Specs"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">"precision_cv"</span><span class="token operator">:</span> <span class="token string">"&lt;2%"</span><span class="token punctuation">,</span>
    <span class="token property">"linearity"</span><span class="token operator">:</span> <span class="token string">"0.5-80 x10¬≥/ŒºL (WBC)"</span><span class="token punctuation">,</span>
    <span class="token property">"carryover"</span><span class="token operator">:</span> <span class="token string">"&lt;0.5%"</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token property">"Created_Date"</span><span class="token operator">:</span> ISODate(<span class="token string">"2024-01-15T00:00:00.000Z"</span>)<span class="token punctuation">,</span>
  <span class="token property">"Updated_Date"</span><span class="token operator">:</span> ISODate(<span class="token string">"2024-10-07T10:30:00.000Z"</span>)
<span class="token punctuation">}</span>
</code></pre><h4 id="-business-rules-cho-instrument_model">üîß Business Rules cho Instrument_Model </h4>
<ul>
<li><strong>Master Data</strong>: Kh√¥ng ƒë∆∞·ª£c x√≥a khi c√≥ instruments ƒëang s·ª≠ d·ª•ng</li>
<li><strong>Version Control</strong>: Model_Version ph·∫£i theo semantic versioning</li>
<li><strong>Test Types</strong>: Supported_Test_Types kh√¥ng ƒë∆∞·ª£c empty</li>
<li><strong>Specifications</strong>: Technical_Specifications ph·∫£i c√≥ ƒë·∫ßy ƒë·ªß th√¥ng tin c·∫ßn thi·∫øt</li>
<li><strong>ID Format</strong>: <code>MDL_{ModelName}_{Manufacturer}_{Version}</code></li>
</ul>
<h3 id="22--collection-2-instrument-collection-instruments">2.2 üî¨ Collection 2: Instrument (Collection: <code>instruments</code>) </h3>
<p><strong>üéØ M·ª•c ƒë√≠ch</strong>: Qu·∫£n l√Ω th√¥ng tin thi·∫øt b·ªã c·ª• th·ªÉ v√† tr·∫°ng th√°i runtime.</p>
<h4 id="schema-definition-1">Schema Definition </h4>
<table>
<thead>
<tr>
<th>Tr∆∞·ªùng</th>
<th>Ki·ªÉu d·ªØ li·ªáu</th>
<th>M√¥ t·∫£</th>
<th>Runtime Info</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Instrument_ID</strong></td>
<td>String (PK)</td>
<td>ID thi·∫øt b·ªã duy nh·∫•t</td>
<td>Auto-generated</td>
</tr>
<tr>
<td><strong>Model_ID</strong></td>
<td>String (FK)</td>
<td>Model thi·∫øt b·ªã</td>
<td>References Instrument_Model</td>
</tr>
<tr>
<td>Serial_Number</td>
<td>String</td>
<td>S·ªë serial</td>
<td>Required, Unique</td>
</tr>
<tr>
<td>Installation_Date</td>
<td>DateTime</td>
<td>Ng√†y l·∫Øp ƒë·∫∑t</td>
<td>Required</td>
</tr>
<tr>
<td>Current_Mode</td>
<td>Enum</td>
<td>Mode hi·ªán t·∫°i</td>
<td>[Ready, Maintenance, Inactive]</td>
</tr>
<tr>
<td>Last_Mode_Change_TS</td>
<td>DateTime</td>
<td>Th·ªùi ƒëi·ªÉm thay ƒë·ªïi mode cu·ªëi</td>
<td>Auto-updated</td>
</tr>
<tr>
<td>Location</td>
<td>String</td>
<td>V·ªã tr√≠ ƒë·∫∑t thi·∫øt b·ªã</td>
<td>Required</td>
</tr>
<tr>
<td>Maintenance_Schedule</td>
<td>Object</td>
<td>L·ªãch b·∫£o tr√¨</td>
<td>JSON format</td>
</tr>
<tr>
<td>QC_Status</td>
<td>Enum</td>
<td>Tr·∫°ng th√°i QC</td>
<td>[Passed, Failed, Pending, NotRequired]</td>
</tr>
<tr>
<td>Is_Active</td>
<td>Boolean</td>
<td>ƒêang ho·∫°t ƒë·ªông</td>
<td>Default: true</td>
</tr>
<tr>
<td>Memory_Usage_Percent</td>
<td>Number</td>
<td>% s·ª≠ d·ª•ng memory</td>
<td>0-100</td>
</tr>
<tr>
<td>Status</td>
<td>Enum</td>
<td>Tr·∫°ng th√°i</td>
<td>[Available, Busy, Error]</td>
</tr>
</tbody>
</table>
<h4 id="-v√≠-d·ª•-document-complete-1">üìÑ V√≠ d·ª• Document Complete </h4>
<pre data-role="codeBlock" data-info="json" class="language-json json"><code><span class="token punctuation">{</span>
  <span class="token property">"_id"</span><span class="token operator">:</span> ObjectId(<span class="token string">"64f123456789abcdef012346"</span>)<span class="token punctuation">,</span>
  <span class="token property">"Instrument_ID"</span><span class="token operator">:</span> <span class="token string">"INS_LAB1_XN1000_001"</span><span class="token punctuation">,</span>
  <span class="token property">"Model_ID"</span><span class="token operator">:</span> <span class="token string">"MDL_XN1000_SYSMEX_V1"</span><span class="token punctuation">,</span>
  <span class="token property">"Device_Info"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">"serial_number"</span><span class="token operator">:</span> <span class="token string">"XN1000-2024-001"</span><span class="token punctuation">,</span>
    <span class="token property">"installation_date"</span><span class="token operator">:</span> ISODate(<span class="token string">"2024-03-15T00:00:00.000Z"</span>)<span class="token punctuation">,</span>
    <span class="token property">"location"</span><span class="token operator">:</span> <span class="token string">"Hematology Lab - Station 1"</span><span class="token punctuation">,</span>
    <span class="token property">"asset_number"</span><span class="token operator">:</span> <span class="token string">"ASSET_2024_001"</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token property">"Current_Status"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">"current_mode"</span><span class="token operator">:</span> <span class="token string">"Ready"</span><span class="token punctuation">,</span>
    <span class="token property">"last_mode_change_ts"</span><span class="token operator">:</span> ISODate(<span class="token string">"2024-10-07T08:00:00.000Z"</span>)<span class="token punctuation">,</span>
    <span class="token property">"status"</span><span class="token operator">:</span> <span class="token string">"Available"</span><span class="token punctuation">,</span>
    <span class="token property">"is_active"</span><span class="token operator">:</span> <span class="token boolean">true</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token property">"Quality_Control"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">"qc_status"</span><span class="token operator">:</span> <span class="token string">"Passed"</span><span class="token punctuation">,</span>
    <span class="token property">"last_qc_run"</span><span class="token operator">:</span> ISODate(<span class="token string">"2024-10-07T07:00:00.000Z"</span>)<span class="token punctuation">,</span>
    <span class="token property">"qc_due_date"</span><span class="token operator">:</span> ISODate(<span class="token string">"2024-10-08T07:00:00.000Z"</span>)<span class="token punctuation">,</span>
    <span class="token property">"qc_results"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token property">"wbc_cv"</span><span class="token operator">:</span> <span class="token number">1.2</span><span class="token punctuation">,</span>
      <span class="token property">"rbc_cv"</span><span class="token operator">:</span> <span class="token number">0.8</span><span class="token punctuation">,</span>
      <span class="token property">"plt_cv"</span><span class="token operator">:</span> <span class="token number">2.1</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token property">"Maintenance_Schedule"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">"daily_maintenance"</span><span class="token operator">:</span> <span class="token string">"07:00"</span><span class="token punctuation">,</span>
    <span class="token property">"weekly_maintenance"</span><span class="token operator">:</span> <span class="token string">"Sunday 18:00"</span><span class="token punctuation">,</span>
    <span class="token property">"monthly_maintenance"</span><span class="token operator">:</span> <span class="token string">"First Sunday 09:00"</span><span class="token punctuation">,</span>
    <span class="token property">"last_maintenance"</span><span class="token operator">:</span> ISODate(<span class="token string">"2024-10-06T18:00:00.000Z"</span>)<span class="token punctuation">,</span>
    <span class="token property">"next_maintenance"</span><span class="token operator">:</span> ISODate(<span class="token string">"2024-10-13T18:00:00.000Z"</span>)
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token property">"Performance_Metrics"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">"memory_usage_percent"</span><span class="token operator">:</span> <span class="token number">45</span><span class="token punctuation">,</span>
    <span class="token property">"daily_throughput"</span><span class="token operator">:</span> <span class="token number">856</span><span class="token punctuation">,</span>
    <span class="token property">"error_rate"</span><span class="token operator">:</span> <span class="token number">0.2</span><span class="token punctuation">,</span>
    <span class="token property">"uptime_percent"</span><span class="token operator">:</span> <span class="token number">99.8</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token property">"Created_Date"</span><span class="token operator">:</span> ISODate(<span class="token string">"2024-03-15T10:00:00.000Z"</span>)<span class="token punctuation">,</span>
  <span class="token property">"Updated_Date"</span><span class="token operator">:</span> ISODate(<span class="token string">"2024-10-07T08:30:00.000Z"</span>)
<span class="token punctuation">}</span>
</code></pre><h4 id="-business-rules-cho-instrument">üîß Business Rules cho Instrument </h4>
<ul>
<li><strong>Unique Serial</strong>: Serial_Number ph·∫£i unique trong h·ªá th·ªëng</li>
<li><strong>Mode Transition</strong>: Ch·ªâ cho ph√©p Ready‚ÜîMaintenance‚ÜîInactive</li>
<li><strong>QC Validation</strong>: Kh√¥ng th·ªÉ chuy·ªÉn sang Ready n·∫øu QC_Status = Failed</li>
<li><strong>Memory Threshold</strong>: C·∫£nh b√°o khi Memory_Usage_Percent &gt; 80%</li>
<li><strong>ID Format</strong>: <code>INS_{Location}_{ModelName}_{Number}</code></li>
</ul>
<h3 id="23--collection-3-instrument_mode_change_log-collection-mode_change_logs">2.3 üîÑ Collection 3: Instrument_Mode_Change_Log (Collection: <code>mode_change_logs</code>) </h3>
<p><strong>üéØ M·ª•c ƒë√≠ch</strong>: Theo d√µi t·∫•t c·∫£ thay ƒë·ªïi mode c·ªßa thi·∫øt b·ªã cho audit v√† troubleshooting.</p>
<h4 id="schema-definition-2">Schema Definition </h4>
<table>
<thead>
<tr>
<th>Tr∆∞·ªùng</th>
<th>Ki·ªÉu d·ªØ li·ªáu</th>
<th>M√¥ t·∫£</th>
<th>Audit Purpose</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Log_ID</strong></td>
<td>String (PK)</td>
<td>ID log thay ƒë·ªïi mode</td>
<td>Auto-generated</td>
</tr>
<tr>
<td><strong>Instrument_ID</strong></td>
<td>String (FK)</td>
<td>Thi·∫øt b·ªã thay ƒë·ªïi</td>
<td>References Instrument</td>
</tr>
<tr>
<td>Timestamp</td>
<td>DateTime</td>
<td>Th·ªùi ƒëi·ªÉm thay ƒë·ªïi</td>
<td>Auto-generated</td>
</tr>
<tr>
<td>User_Performed</td>
<td>String</td>
<td>Ng∆∞·ªùi th·ª±c hi·ªán</td>
<td>Required</td>
</tr>
<tr>
<td>Previous_Mode</td>
<td>Enum</td>
<td>Mode tr∆∞·ªõc</td>
<td>[Ready, Maintenance, Inactive]</td>
</tr>
<tr>
<td>New_Mode</td>
<td>Enum</td>
<td>Mode m·ªõi</td>
<td>[Ready, Maintenance, Inactive]</td>
</tr>
<tr>
<td>Reason_Provided</td>
<td>String</td>
<td>L√Ω do thay ƒë·ªïi</td>
<td>Required</td>
</tr>
<tr>
<td>QC_Confirmation</td>
<td>Boolean</td>
<td>X√°c nh·∫≠n QC</td>
<td>Required for Ready mode</td>
</tr>
<tr>
<td>Approved_By</td>
<td>String</td>
<td>Ng∆∞·ªùi ph√™ duy·ªát</td>
<td>Required</td>
</tr>
</tbody>
</table>
<h4 id="-v√≠-d·ª•-document-complete-2">üìÑ V√≠ d·ª• Document Complete </h4>
<pre data-role="codeBlock" data-info="json" class="language-json json"><code><span class="token punctuation">{</span>
  <span class="token property">"_id"</span><span class="token operator">:</span> ObjectId(<span class="token string">"64f123456789abcdef012347"</span>)<span class="token punctuation">,</span>
  <span class="token property">"Log_ID"</span><span class="token operator">:</span> <span class="token string">"MODE_20241007_001"</span><span class="token punctuation">,</span>
  <span class="token property">"Instrument_ID"</span><span class="token operator">:</span> <span class="token string">"INS_LAB1_XN1000_001"</span><span class="token punctuation">,</span>
  <span class="token property">"Mode_Change_Details"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">"timestamp"</span><span class="token operator">:</span> ISODate(<span class="token string">"2024-10-07T08:30:00.000Z"</span>)<span class="token punctuation">,</span>
    <span class="token property">"user_performed"</span><span class="token operator">:</span> <span class="token string">"TECH_001"</span><span class="token punctuation">,</span>
    <span class="token property">"previous_mode"</span><span class="token operator">:</span> <span class="token string">"Maintenance"</span><span class="token punctuation">,</span>
    <span class="token property">"new_mode"</span><span class="token operator">:</span> <span class="token string">"Ready"</span><span class="token punctuation">,</span>
    <span class="token property">"reason_provided"</span><span class="token operator">:</span> <span class="token string">"Completed scheduled maintenance and QC validation"</span><span class="token punctuation">,</span>
    <span class="token property">"qc_confirmation"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    <span class="token property">"approved_by"</span><span class="token operator">:</span> <span class="token string">"SUPERVISOR_001"</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token property">"Pre_Change_Validation"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">"qc_status"</span><span class="token operator">:</span> <span class="token string">"Passed"</span><span class="token punctuation">,</span>
    <span class="token property">"reagent_levels"</span><span class="token operator">:</span> <span class="token string">"Sufficient"</span><span class="token punctuation">,</span> 
    <span class="token property">"maintenance_completed"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    <span class="token property">"calibration_current"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    <span class="token property">"system_errors"</span><span class="token operator">:</span> <span class="token string">"None"</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token property">"Post_Change_Status"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">"mode_set_successfully"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    <span class="token property">"system_ready"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    <span class="token property">"first_test_timestamp"</span><span class="token operator">:</span> ISODate(<span class="token string">"2024-10-07T08:45:00.000Z"</span>)<span class="token punctuation">,</span>
    <span class="token property">"performance_normal"</span><span class="token operator">:</span> <span class="token boolean">true</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token property">"Approval_Chain"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">"requested_by"</span><span class="token operator">:</span> <span class="token string">"TECH_001"</span><span class="token punctuation">,</span>
    <span class="token property">"approved_by"</span><span class="token operator">:</span> <span class="token string">"SUPERVISOR_001"</span><span class="token punctuation">,</span>
    <span class="token property">"approval_timestamp"</span><span class="token operator">:</span> ISODate(<span class="token string">"2024-10-07T08:25:00.000Z"</span>)<span class="token punctuation">,</span>
    <span class="token property">"approval_comments"</span><span class="token operator">:</span> <span class="token string">"QC passed, maintenance complete"</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><h4 id="-business-rules-cho-instrument_mode_change_log">üîß Business Rules cho Instrument_Mode_Change_Log </h4>
<ul>
<li><strong>Immutable</strong>: Audit logs kh√¥ng ƒë∆∞·ª£c s·ª≠a ƒë·ªïi sau khi t·∫°o</li>
<li><strong>QC Requirement</strong>: Chuy·ªÉn sang Ready b·∫Øt bu·ªôc QC_Confirmation = true</li>
<li><strong>Approval Chain</strong>: M·ªçi thay ƒë·ªïi mode ƒë·ªÅu ph·∫£i c√≥ approval</li>
<li><strong>Automatic Logging</strong>: T·ª± ƒë·ªông t·∫°o log cho m·ªçi mode change</li>
<li><strong>ID Format</strong>: <code>MODE_{YYYYMMDD}_{SequenceNumber}</code></li>
</ul>
<hr>
<h2 id="3-test-results-management-collection-4-7">3. Test Results Management (Collection 4-7) </h2>
<h3 id="31--collection-4-raw_test_result-collection-raw_test_results">3.1 üìä Collection 4: Raw_Test_Result (Collection: <code>raw_test_results</code>) </h3>
<p><strong>üéØ M·ª•c ƒë√≠ch</strong>: L∆∞u tr·ªØ k·∫øt qu·∫£ x√©t nghi·ªám th√¥ t·ª´ thi·∫øt b·ªã v√† qu·∫£n l√Ω lifecycle c·ªßa ch√∫ng.</p>
<h4 id="schema-definition-3">Schema Definition </h4>
<table>
<thead>
<tr>
<th>Tr∆∞·ªùng</th>
<th>Ki·ªÉu d·ªØ li·ªáu</th>
<th>M√¥ t·∫£</th>
<th>Data Management</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Result_ID</strong></td>
<td>String (PK)</td>
<td>ID k·∫øt qu·∫£ duy nh·∫•t</td>
<td>Auto-generated</td>
</tr>
<tr>
<td><strong>Instrument_ID</strong></td>
<td>String (FK)</td>
<td>Thi·∫øt b·ªã t·∫°o k·∫øt qu·∫£</td>
<td>References Instrument</td>
</tr>
<tr>
<td>Test_Order_ID</td>
<td>String</td>
<td>ID l·ªánh x√©t nghi·ªám</td>
<td>May be auto-generated</td>
</tr>
<tr>
<td>Sample_Barcode</td>
<td>String</td>
<td>M√£ v·∫°ch m·∫´u</td>
<td>Required</td>
</tr>
<tr>
<td>Raw_HL7_Message</td>
<td>String</td>
<td>Message HL7 th√¥</td>
<td>Required, Large text</td>
</tr>
<tr>
<td>Analysis_Start_TS</td>
<td>DateTime</td>
<td>Th·ªùi ƒëi·ªÉm b·∫Øt ƒë·∫ßu ph√¢n t√≠ch</td>
<td>Auto-generated</td>
</tr>
<tr>
<td>Analysis_Completion_TS</td>
<td>DateTime</td>
<td>Th·ªùi ƒëi·ªÉm ho√†n th√†nh</td>
<td>Auto-generated</td>
</tr>
<tr>
<td>Result_Status</td>
<td>Enum</td>
<td>Tr·∫°ng th√°i k·∫øt qu·∫£</td>
<td>[Completed, Processing, Failed, Pending]</td>
</tr>
<tr>
<td>Quality_Flags</td>
<td>Array[String]</td>
<td>C√°c flag ch·∫•t l∆∞·ª£ng</td>
<td>Optional</td>
</tr>
<tr>
<td>Publish_Status</td>
<td>Enum</td>
<td>Tr·∫°ng th√°i publish</td>
<td>[Sent, Failed, Pending]</td>
</tr>
<tr>
<td>Is_Backup_Stored</td>
<td>Boolean</td>
<td>ƒê√£ backup</td>
<td>Default: false</td>
</tr>
<tr>
<td>Memory_Size_KB</td>
<td>Number</td>
<td>K√≠ch th∆∞·ªõc data</td>
<td>For cleanup</td>
</tr>
</tbody>
</table>
<h4 id="-v√≠-d·ª•-document-complete-3">üìÑ V√≠ d·ª• Document Complete </h4>
<pre data-role="codeBlock" data-info="json" class="language-json json"><code><span class="token punctuation">{</span>
  <span class="token property">"_id"</span><span class="token operator">:</span> ObjectId(<span class="token string">"64f123456789abcdef012348"</span>)<span class="token punctuation">,</span>
  <span class="token property">"Result_ID"</span><span class="token operator">:</span> <span class="token string">"RST_20241007_001"</span><span class="token punctuation">,</span>
  <span class="token property">"Instrument_ID"</span><span class="token operator">:</span> <span class="token string">"INS_LAB1_XN1000_001"</span><span class="token punctuation">,</span>
  <span class="token property">"Test_Info"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">"test_order_id"</span><span class="token operator">:</span> <span class="token string">"ORD_2024_1007_0001"</span><span class="token punctuation">,</span>
    <span class="token property">"sample_barcode"</span><span class="token operator">:</span> <span class="token string">"SMP20241007001"</span><span class="token punctuation">,</span>
    <span class="token property">"test_type"</span><span class="token operator">:</span> <span class="token string">"CBC+Diff"</span><span class="token punctuation">,</span>
    <span class="token property">"operator_id"</span><span class="token operator">:</span> <span class="token string">"TECH_001"</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token property">"Timing_Info"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">"analysis_start_ts"</span><span class="token operator">:</span> ISODate(<span class="token string">"2024-10-07T09:15:00.000Z"</span>)<span class="token punctuation">,</span>
    <span class="token property">"analysis_completion_ts"</span><span class="token operator">:</span> ISODate(<span class="token string">"2024-10-07T09:18:30.000Z"</span>)<span class="token punctuation">,</span>
    <span class="token property">"processing_time_seconds"</span><span class="token operator">:</span> <span class="token number">210</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token property">"Raw_HL7_Message"</span><span class="token operator">:</span> <span class="token string">"MSH|^~\\&amp;|XN1000|LAB1|LIS|HOSPITAL|20241007091830||ORU^R01|MSG001|P|2.5\nPID|1||PAT001||Nguyen^Van^A||19900101|M\nOBR|1||ORD_2024_1007_0001|CBC+Diff||20241007091500\nOBX|1|NM|WBC|5.8|10*3/uL|4.0-10.0|N|||F\nOBX|2|NM|RBC|4.2|10*6/uL|4.0-5.2|N|||F"</span><span class="token punctuation">,</span>
  <span class="token property">"Result_Status"</span><span class="token operator">:</span> <span class="token string">"Completed"</span><span class="token punctuation">,</span>
  <span class="token property">"Quality_Control"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">"quality_flags"</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">"Normal"</span><span class="token punctuation">,</span> <span class="token string">"No Interference"</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token property">"qc_level"</span><span class="token operator">:</span> <span class="token string">"Level_2"</span><span class="token punctuation">,</span>
    <span class="token property">"sample_quality"</span><span class="token operator">:</span> <span class="token string">"Good"</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token property">"Publishing_Info"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">"publish_status"</span><span class="token operator">:</span> <span class="token string">"Sent"</span><span class="token punctuation">,</span>
    <span class="token property">"publish_attempts"</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
    <span class="token property">"last_publish_ts"</span><span class="token operator">:</span> ISODate(<span class="token string">"2024-10-07T09:19:00.000Z"</span>)<span class="token punctuation">,</span>
    <span class="token property">"target_services"</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">"TestOrderService"</span><span class="token punctuation">,</span> <span class="token string">"MonitoringService"</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token property">"Storage_Info"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">"is_backup_stored"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    <span class="token property">"backup_location"</span><span class="token operator">:</span> <span class="token string">"MonitoringService_Backup_DB"</span><span class="token punctuation">,</span>
    <span class="token property">"memory_size_kb"</span><span class="token operator">:</span> <span class="token number">12.5</span><span class="token punctuation">,</span>
    <span class="token property">"retention_until"</span><span class="token operator">:</span> ISODate(<span class="token string">"2024-10-14T09:18:30.000Z"</span>)
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token property">"Created_Date"</span><span class="token operator">:</span> ISODate(<span class="token string">"2024-10-07T09:18:30.000Z"</span>)
<span class="token punctuation">}</span>
</code></pre><h4 id="-business-rules-cho-raw_test_result">üîß Business Rules cho Raw_Test_Result </h4>
<ul>
<li><strong>Data Integrity</strong>: Raw_HL7_Message kh√¥ng ƒë∆∞·ª£c modify sau khi t·∫°o</li>
<li><strong>Retention Policy</strong>: X√≥a sau 7 ng√†y n·∫øu ƒë√£ backup v√† publish th√†nh c√¥ng</li>
<li><strong>Quality Flags</strong>: T·ª± ƒë·ªông validate v√† g·∫Øn quality flags</li>
<li><strong>Publish Requirement</strong>: Ph·∫£i publish th√†nh c√¥ng tr∆∞·ªõc khi cleanup</li>
<li><strong>ID Format</strong>: <code>RST_{YYYYMMDD}_{SequenceNumber}</code></li>
</ul>
<h3 id="32--collection-5-hl7_publish_log-collection-hl7_publish_logs">3.2 üì§ Collection 5: HL7_Publish_Log (Collection: <code>hl7_publish_logs</code>) </h3>
<p><strong>üéØ M·ª•c ƒë√≠ch</strong>: Theo d√µi vi·ªác publish k·∫øt qu·∫£ HL7 t·ªõi c√°c service kh√°c v√† retry mechanism.</p>
<h4 id="schema-definition-4">Schema Definition </h4>
<table>
<thead>
<tr>
<th>Tr∆∞·ªùng</th>
<th>Ki·ªÉu d·ªØ li·ªáu</th>
<th>M√¥ t·∫£</th>
<th>Publish Tracking</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Publish_ID</strong></td>
<td>String (PK)</td>
<td>ID publish duy nh·∫•t</td>
<td>Auto-generated</td>
</tr>
<tr>
<td><strong>Result_ID</strong></td>
<td>String (FK)</td>
<td>K·∫øt qu·∫£ ƒë∆∞·ª£c publish</td>
<td>References Raw_Test_Result</td>
</tr>
<tr>
<td>Target_Service</td>
<td>Enum</td>
<td>Service ƒë√≠ch</td>
<td>[TestOrderService, MonitoringService]</td>
</tr>
<tr>
<td>Publish_Timestamp</td>
<td>DateTime</td>
<td>Th·ªùi ƒëi·ªÉm publish</td>
<td>Auto-generated</td>
</tr>
<tr>
<td>Publish_Status</td>
<td>Enum</td>
<td>Tr·∫°ng th√°i publish</td>
<td>[Success, Failed, Retry]</td>
</tr>
<tr>
<td>Error_Message</td>
<td>String</td>
<td>L·ªói n·∫øu c√≥</td>
<td>Nullable</td>
</tr>
<tr>
<td>Retry_Count</td>
<td>Number</td>
<td>S·ªë l·∫ßn retry</td>
<td>Default: 0</td>
</tr>
<tr>
<td>Last_Retry_TS</td>
<td>DateTime</td>
<td>L·∫ßn retry cu·ªëi</td>
<td>Nullable</td>
</tr>
<tr>
<td>Response_Code</td>
<td>String</td>
<td>M√£ response</td>
<td>HTTP status</td>
</tr>
<tr>
<td>Processing_Time_MS</td>
<td>Number</td>
<td>Th·ªùi gian x·ª≠ l√Ω</td>
<td>Performance metric</td>
</tr>
</tbody>
</table>
<h4 id="-v√≠-d·ª•-document-complete-4">üìÑ V√≠ d·ª• Document Complete </h4>
<pre data-role="codeBlock" data-info="json" class="language-json json"><code><span class="token punctuation">{</span>
  <span class="token property">"_id"</span><span class="token operator">:</span> ObjectId(<span class="token string">"64f123456789abcdef012349"</span>)<span class="token punctuation">,</span>
  <span class="token property">"Publish_ID"</span><span class="token operator">:</span> <span class="token string">"PUB_20241007_001"</span><span class="token punctuation">,</span>
  <span class="token property">"Result_ID"</span><span class="token operator">:</span> <span class="token string">"RST_20241007_001"</span><span class="token punctuation">,</span>
  <span class="token property">"Target_Service"</span><span class="token operator">:</span> <span class="token string">"TestOrderService"</span><span class="token punctuation">,</span>
  <span class="token property">"Publishing_Details"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">"publish_timestamp"</span><span class="token operator">:</span> ISODate(<span class="token string">"2024-10-07T09:19:00.000Z"</span>)<span class="token punctuation">,</span>
    <span class="token property">"publish_status"</span><span class="token operator">:</span> <span class="token string">"Success"</span><span class="token punctuation">,</span>
    <span class="token property">"response_code"</span><span class="token operator">:</span> <span class="token string">"200"</span><span class="token punctuation">,</span>
    <span class="token property">"processing_time_ms"</span><span class="token operator">:</span> <span class="token number">245</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token property">"Request_Info"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">"endpoint"</span><span class="token operator">:</span> <span class="token string">"https://testorder-service/api/v1/results"</span><span class="token punctuation">,</span>
    <span class="token property">"method"</span><span class="token operator">:</span> <span class="token string">"POST"</span><span class="token punctuation">,</span>
    <span class="token property">"content_type"</span><span class="token operator">:</span> <span class="token string">"application/hl7-v2"</span><span class="token punctuation">,</span>
    <span class="token property">"message_size_kb"</span><span class="token operator">:</span> <span class="token number">12.5</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token property">"Response_Info"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">"response_timestamp"</span><span class="token operator">:</span> ISODate(<span class="token string">"2024-10-07T09:19:00.245Z"</span>)<span class="token punctuation">,</span>
    <span class="token property">"response_message"</span><span class="token operator">:</span> <span class="token string">"Result received and processed successfully"</span><span class="token punctuation">,</span>
    <span class="token property">"correlation_id"</span><span class="token operator">:</span> <span class="token string">"CORR_20241007_001"</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token property">"Retry_Info"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">"retry_count"</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
    <span class="token property">"max_retries"</span><span class="token operator">:</span> <span class="token number">3</span><span class="token punctuation">,</span>
    <span class="token property">"retry_interval_seconds"</span><span class="token operator">:</span> <span class="token number">30</span><span class="token punctuation">,</span>
    <span class="token property">"last_retry_ts"</span><span class="token operator">:</span> <span class="token null keyword">null</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token property">"Performance_Metrics"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">"network_latency_ms"</span><span class="token operator">:</span> <span class="token number">45</span><span class="token punctuation">,</span>
    <span class="token property">"service_response_time_ms"</span><span class="token operator">:</span> <span class="token number">200</span><span class="token punctuation">,</span>
    <span class="token property">"total_processing_time_ms"</span><span class="token operator">:</span> <span class="token number">245</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><h4 id="-business-rules-cho-hl7_publish_log">üîß Business Rules cho HL7_Publish_Log </h4>
<ul>
<li><strong>Retry Logic</strong>: T·ªëi ƒëa 3 l·∫ßn retry v·ªõi exponential backoff</li>
<li><strong>Timeout</strong>: 30 gi√¢y timeout cho m·ªói publish attempt</li>
<li><strong>Success Criteria</strong>: Response_Code = 200 v√† valid response message</li>
<li><strong>Error Handling</strong>: Log chi ti·∫øt error message cho troubleshooting</li>
<li><strong>ID Format</strong>: <code>PUB_{YYYYMMDD}_{SequenceNumber}</code></li>
</ul>
<h3 id="33-Ô∏è-collection-6-raw_result_deletion_log-collection-result_deletion_logs">3.3 üóëÔ∏è Collection 6: Raw_Result_Deletion_Log (Collection: <code>result_deletion_logs</code>) </h3>
<p><strong>üéØ M·ª•c ƒë√≠ch</strong>: Audit trail cho vi·ªác x√≥a k·∫øt qu·∫£ th√¥, tu√¢n th·ªß c√°c quy ƒë·ªãnh v·ªÅ compliance v√† traceability.</p>
<h4 id="schema-definition-5">Schema Definition </h4>
<table>
<thead>
<tr>
<th>Tr∆∞·ªùng</th>
<th>Ki·ªÉu d·ªØ li·ªáu</th>
<th>M√¥ t·∫£</th>
<th>Compliance</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Deletion_Log_ID</strong></td>
<td>String (PK)</td>
<td>ID log x√≥a</td>
<td>Auto-generated</td>
</tr>
<tr>
<td><strong>Result_ID</strong></td>
<td>String (FK)</td>
<td>K·∫øt qu·∫£ ƒë√£ x√≥a</td>
<td>May be null after deletion</td>
</tr>
<tr>
<td>User_Performed</td>
<td>String</td>
<td>Ng∆∞·ªùi th·ª±c hi·ªán (manual)</td>
<td>Nullable for auto</td>
</tr>
<tr>
<td>Deletion_Timestamp</td>
<td>DateTime</td>
<td>Th·ªùi ƒëi·ªÉm x√≥a</td>
<td>Required</td>
</tr>
<tr>
<td>Test_Order_ID</td>
<td>String</td>
<td>ID l·ªánh x√©t nghi·ªám ƒë√£ x√≥a</td>
<td>For audit</td>
</tr>
<tr>
<td>Sample_Barcode</td>
<td>String</td>
<td>M√£ v·∫°ch ƒë√£ x√≥a</td>
<td>For audit</td>
</tr>
<tr>
<td>Deletion_Type</td>
<td>Enum</td>
<td>Lo·∫°i x√≥a</td>
<td>[Manual, Auto, Scheduled]</td>
</tr>
<tr>
<td>Deletion_Reason</td>
<td>String</td>
<td>L√Ω do x√≥a</td>
<td>Required</td>
</tr>
<tr>
<td>Approved_By</td>
<td>String</td>
<td>Ng∆∞·ªùi ph√™ duy·ªát</td>
<td>Required for manual</td>
</tr>
<tr>
<td>Memory_Freed_KB</td>
<td>Number</td>
<td>B·ªô nh·ªõ ƒë∆∞·ª£c gi·∫£i ph√≥ng</td>
<td>Performance tracking</td>
</tr>
<tr>
<td>Backup_Verification_Status</td>
<td>Enum</td>
<td>X√°c minh backup</td>
<td>[Verified, NotVerified, Failed]</td>
</tr>
</tbody>
</table>
<h4 id="-v√≠-d·ª•-document-complete-5">üìÑ V√≠ d·ª• Document Complete </h4>
<pre data-role="codeBlock" data-info="json" class="language-json json"><code><span class="token punctuation">{</span>
  <span class="token property">"_id"</span><span class="token operator">:</span> ObjectId(<span class="token string">"64f123456789abcdef01234a"</span>)<span class="token punctuation">,</span>
  <span class="token property">"Deletion_Log_ID"</span><span class="token operator">:</span> <span class="token string">"DEL_20241007_001"</span><span class="token punctuation">,</span>
  <span class="token property">"Result_ID"</span><span class="token operator">:</span> <span class="token string">"RST_20241006_045"</span><span class="token punctuation">,</span>
  <span class="token property">"Deletion_Details"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">"user_performed"</span><span class="token operator">:</span> <span class="token string">"SYSTEM_AUTO"</span><span class="token punctuation">,</span>
    <span class="token property">"deletion_timestamp"</span><span class="token operator">:</span> ISODate(<span class="token string">"2024-10-07T12:00:00.000Z"</span>)<span class="token punctuation">,</span>
    <span class="token property">"deletion_type"</span><span class="token operator">:</span> <span class="token string">"Auto"</span><span class="token punctuation">,</span>
    <span class="token property">"deletion_reason"</span><span class="token operator">:</span> <span class="token string">"Automatic cleanup - data older than retention period"</span><span class="token punctuation">,</span>
    <span class="token property">"approved_by"</span><span class="token operator">:</span> <span class="token string">"SYSTEM_AUTO"</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token property">"Original_Data_Info"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">"test_order_id"</span><span class="token operator">:</span> <span class="token string">"ORD_2024_1006_0045"</span><span class="token punctuation">,</span>
    <span class="token property">"sample_barcode"</span><span class="token operator">:</span> <span class="token string">"SMP20241006045"</span><span class="token punctuation">,</span> 
    <span class="token property">"instrument_id"</span><span class="token operator">:</span> <span class="token string">"INS_LAB1_XN1000_001"</span><span class="token punctuation">,</span>
    <span class="token property">"test_type"</span><span class="token operator">:</span> <span class="token string">"CBC+Diff"</span><span class="token punctuation">,</span>
    <span class="token property">"analysis_timestamp"</span><span class="token operator">:</span> ISODate(<span class="token string">"2024-10-06T14:30:00.000Z"</span>)
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token property">"System_Metrics"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">"memory_freed_kb"</span><span class="token operator">:</span> <span class="token number">15.7</span><span class="token punctuation">,</span>
    <span class="token property">"storage_freed_mb"</span><span class="token operator">:</span> <span class="token number">0.8</span><span class="token punctuation">,</span>
    <span class="token property">"processing_time_ms"</span><span class="token operator">:</span> <span class="token number">45</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token property">"Backup_Information"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">"backup_verification_status"</span><span class="token operator">:</span> <span class="token string">"Verified"</span><span class="token punctuation">,</span>
    <span class="token property">"backup_location"</span><span class="token operator">:</span> <span class="token string">"MonitoringService_Backup_DB"</span><span class="token punctuation">,</span>
    <span class="token property">"backup_timestamp"</span><span class="token operator">:</span> ISODate(<span class="token string">"2024-10-06T15:00:00.000Z"</span>)<span class="token punctuation">,</span>
    <span class="token property">"backup_checksum"</span><span class="token operator">:</span> <span class="token string">"a1b2c3d4e5f6..."</span><span class="token punctuation">,</span>
    <span class="token property">"verification_timestamp"</span><span class="token operator">:</span> ISODate(<span class="token string">"2024-10-07T11:58:00.000Z"</span>)
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token property">"Compliance_Info"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">"regulatory_requirement"</span><span class="token operator">:</span> <span class="token string">"Data retention 7 days after backup"</span><span class="token punctuation">,</span>
    <span class="token property">"retention_period_days"</span><span class="token operator">:</span> <span class="token number">7</span><span class="token punctuation">,</span>
    <span class="token property">"deletion_policy_version"</span><span class="token operator">:</span> <span class="token string">"v2.1"</span><span class="token punctuation">,</span>
    <span class="token property">"audit_trail_preserved"</span><span class="token operator">:</span> <span class="token boolean">true</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><h4 id="-business-rules-cho-raw_result_deletion_log">üîß Business Rules cho Raw_Result_Deletion_Log </h4>
<ul>
<li><strong>Backup Required</strong>: Ch·ªâ x√≥a khi Backup_Verification_Status = "Verified"</li>
<li><strong>Retention</strong>: Audit logs gi·ªØ vƒ©nh vi·ªÖn, kh√¥ng x√≥a</li>
<li><strong>Approval</strong>: Manual deletion c·∫ßn approval t·ª´ supervisor</li>
<li><strong>Compliance</strong>: Tu√¢n th·ªß quy ƒë·ªãnh v·ªÅ data retention</li>
<li><strong>ID Format</strong>: <code>DEL_{YYYYMMDD}_{SequenceNumber}</code></li>
</ul>
<h3 id="34--collection-7-auto_test_order_creation-collection-auto_test_orders">3.4 üîÑ Collection 7: Auto_Test_Order_Creation (Collection: <code>auto_test_orders</code>) </h3>
<p><strong>üéØ M·ª•c ƒë√≠ch</strong>: Qu·∫£n l√Ω vi·ªác t·ª± ƒë·ªông t·∫°o test order khi c√≥ barcode nh∆∞ng thi·∫øu test order trong h·ªá th·ªëng.</p>
<h4 id="schema-definition-6">Schema Definition </h4>
<table>
<thead>
<tr>
<th>Tr∆∞·ªùng</th>
<th>Ki·ªÉu d·ªØ li·ªáu</th>
<th>M√¥ t·∫£</th>
<th>Workflow</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Creation_ID</strong></td>
<td>String (PK)</td>
<td>ID t·∫°o t·ª± ƒë·ªông</td>
<td>Auto-generated</td>
</tr>
<tr>
<td>Sample_Barcode</td>
<td>String</td>
<td>M√£ v·∫°ch m·∫´u</td>
<td>Trigger condition</td>
</tr>
<tr>
<td>Generated_Test_Order_ID</td>
<td>String</td>
<td>Test order ƒë∆∞·ª£c t·∫°o</td>
<td>Auto-generated</td>
</tr>
<tr>
<td><strong>Instrument_ID</strong></td>
<td>String (FK)</td>
<td>Thi·∫øt b·ªã t·∫°o</td>
<td>References Instrument</td>
</tr>
<tr>
<td>Creation_Timestamp</td>
<td>DateTime</td>
<td>Th·ªùi ƒëi·ªÉm t·∫°o</td>
<td>Auto-generated</td>
</tr>
<tr>
<td>User_Notified</td>
<td>Boolean</td>
<td>ƒê√£ th√¥ng b√°o user</td>
<td>Default: false</td>
</tr>
<tr>
<td>Patient_Info_Updated</td>
<td>Boolean</td>
<td>ƒê√£ c·∫≠p nh·∫≠t th√¥ng tin BN</td>
<td>Default: false</td>
</tr>
<tr>
<td>Status</td>
<td>Enum</td>
<td>Tr·∫°ng th√°i</td>
<td>[Created, Pending_Update, Completed]</td>
</tr>
<tr>
<td>Notes</td>
<td>String</td>
<td>Ghi ch√∫</td>
<td>Optional</td>
</tr>
</tbody>
</table>
<h4 id="-v√≠-d·ª•-document-complete-6">üìÑ V√≠ d·ª• Document Complete </h4>
<pre data-role="codeBlock" data-info="json" class="language-json json"><code><span class="token punctuation">{</span>
  <span class="token property">"_id"</span><span class="token operator">:</span> ObjectId(<span class="token string">"64f123456789abcdef01234b"</span>)<span class="token punctuation">,</span>
  <span class="token property">"Creation_ID"</span><span class="token operator">:</span> <span class="token string">"AUTO_20241007_001"</span><span class="token punctuation">,</span>
  <span class="token property">"Sample_Barcode"</span><span class="token operator">:</span> <span class="token string">"SMP20241007002"</span><span class="token punctuation">,</span>
  <span class="token property">"Generated_Test_Order_ID"</span><span class="token operator">:</span> <span class="token string">"ORD_AUTO_2024_1007_0001"</span><span class="token punctuation">,</span>
  <span class="token property">"Instrument_ID"</span><span class="token operator">:</span> <span class="token string">"INS_LAB1_XN1000_001"</span><span class="token punctuation">,</span>
  <span class="token property">"Creation_Timestamp"</span><span class="token operator">:</span> ISODate(<span class="token string">"2024-10-07T11:15:00.000Z"</span>)<span class="token punctuation">,</span>
  <span class="token property">"Trigger_Context"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">"reason"</span><span class="token operator">:</span> <span class="token string">"Sample scanned but no existing order found"</span><span class="token punctuation">,</span>
    <span class="token property">"scan_timestamp"</span><span class="token operator">:</span> ISODate(<span class="token string">"2024-10-07T11:14:45.000Z"</span>)<span class="token punctuation">,</span>
    <span class="token property">"operator_id"</span><span class="token operator">:</span> <span class="token string">"TECH_001"</span><span class="token punctuation">,</span>
    <span class="token property">"sample_type"</span><span class="token operator">:</span> <span class="token string">"Whole Blood"</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token property">"Auto_Order_Details"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">"default_tests"</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">"CBC"</span><span class="token punctuation">,</span> <span class="token string">"CBC+Diff"</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token property">"priority"</span><span class="token operator">:</span> <span class="token string">"Routine"</span><span class="token punctuation">,</span>
    <span class="token property">"estimated_completion"</span><span class="token operator">:</span> ISODate(<span class="token string">"2024-10-07T12:15:00.000Z"</span>)<span class="token punctuation">,</span>
    <span class="token property">"auto_approval"</span><span class="token operator">:</span> <span class="token boolean">false</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token property">"Patient_Info"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">"patient_id_placeholder"</span><span class="token operator">:</span> <span class="token string">"UNKNOWN_PAT_001"</span><span class="token punctuation">,</span>
    <span class="token property">"sample_collection_time"</span><span class="token operator">:</span> ISODate(<span class="token string">"2024-10-07T10:30:00.000Z"</span>)<span class="token punctuation">,</span>
    <span class="token property">"collection_location"</span><span class="token operator">:</span> <span class="token string">"Ward A"</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token property">"Notification_Status"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">"user_notified"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    <span class="token property">"notification_timestamp"</span><span class="token operator">:</span> ISODate(<span class="token string">"2024-10-07T11:15:30.000Z"</span>)<span class="token punctuation">,</span>
    <span class="token property">"notification_method"</span><span class="token operator">:</span> <span class="token string">"Email+SMS"</span><span class="token punctuation">,</span>
    <span class="token property">"notified_users"</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">"lab_supervisor@hospital.com"</span><span class="token punctuation">,</span> <span class="token string">"tech_001@hospital.com"</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token property">"Status"</span><span class="token operator">:</span> <span class="token string">"Pending_Update"</span><span class="token punctuation">,</span>
  <span class="token property">"Notes"</span><span class="token operator">:</span> <span class="token string">"Auto-created due to missing order. Awaiting patient information update from nursing staff."</span>
<span class="token punctuation">}</span>
</code></pre><h4 id="-business-rules-cho-auto_test_order_creation">üîß Business Rules cho Auto_Test_Order_Creation </h4>
<ul>
<li><strong>Trigger Condition</strong>: T·ª± ƒë·ªông trigger khi scan barcode kh√¥ng c√≥ order</li>
<li><strong>Default Tests</strong>: √Åp d·ª•ng test m·∫∑c ƒë·ªãnh theo instrument model</li>
<li><strong>Notification Required</strong>: Ph·∫£i notify user trong v√≤ng 5 ph√∫t</li>
<li><strong>Manual Update</strong>: C·∫ßn c·∫≠p nh·∫≠t patient info manually sau khi t·∫°o</li>
<li><strong>ID Format</strong>: <code>AUTO_{YYYYMMDD}_{SequenceNumber}</code></li>
</ul>
<hr>
<h2 id="4-reagents-management-collection-8-10">4. Reagents Management (Collection 8-10) </h2>
<h3 id="41--collection-8-reagent-collection-reagents">4.1 üß™ Collection 8: Reagent (Collection: <code>reagents</code>) </h3>
<p><strong>üéØ M·ª•c ƒë√≠ch</strong>: Qu·∫£n l√Ω th√¥ng tin thu·ªëc th·ª≠, inventory v√† lifecycle t·ª´ nh·∫≠p kho ƒë·∫øn s·ª≠ d·ª•ng.</p>
<h4 id="schema-definition-7">Schema Definition </h4>
<table>
<thead>
<tr>
<th>Tr∆∞·ªùng</th>
<th>Ki·ªÉu d·ªØ li·ªáu</th>
<th>M√¥ t·∫£</th>
<th>Validation Rules</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Reagent_ID</strong></td>
<td>String (PK)</td>
<td>ID duy nh·∫•t thu·ªëc th·ª≠</td>
<td>Auto-generated</td>
</tr>
<tr>
<td>Reagent_Name</td>
<td>String</td>
<td>T√™n thu·ªëc th·ª≠</td>
<td>Required, Max 200 chars</td>
</tr>
<tr>
<td>Reagent_Type</td>
<td>String</td>
<td>Lo·∫°i thu·ªëc th·ª≠</td>
<td>Required</td>
</tr>
<tr>
<td>Part_Number</td>
<td>String</td>
<td>S·ªë part c·ªßa nh√† s·∫£n xu·∫•t</td>
<td>Required for traceability</td>
</tr>
<tr>
<td>Current_Quantity</td>
<td>Number</td>
<td>S·ªë l∆∞·ª£ng hi·ªán t·∫°i</td>
<td>&gt;= 0</td>
</tr>
<tr>
<td>Initial_Quantity</td>
<td>Number</td>
<td>S·ªë l∆∞·ª£ng ban ƒë·∫ßu</td>
<td>&gt; 0</td>
</tr>
<tr>
<td>Unit_Measure</td>
<td>String</td>
<td>ƒê∆°n v·ªã ƒëo</td>
<td>[mL, ŒºL, tests, units, vials]</td>
</tr>
<tr>
<td>Expiration_Date</td>
<td>Date</td>
<td>Ng√†y h·∫øt h·∫°n</td>
<td>Must be future date on creation</td>
</tr>
<tr>
<td>Lot_Number</td>
<td>String</td>
<td>S·ªë l√¥</td>
<td>Required for traceability</td>
</tr>
<tr>
<td>Vendor_ID</td>
<td>String</td>
<td>ID nh√† cung c·∫•p</td>
<td>References Vendor</td>
</tr>
<tr>
<td>Vendor_Name</td>
<td>String</td>
<td>T√™n nh√† cung c·∫•p</td>
<td>Required</td>
</tr>
<tr>
<td>Storage_Conditions</td>
<td>Object</td>
<td>ƒêi·ªÅu ki·ªán b·∫£o qu·∫£n</td>
<td>JSON format</td>
</tr>
<tr>
<td>Is_Active</td>
<td>Boolean</td>
<td>C√≤n ho·∫°t ƒë·ªông</td>
<td>Default: true</td>
</tr>
<tr>
<td>In_Use_Status</td>
<td>Enum</td>
<td>Tr·∫°ng th√°i s·ª≠ d·ª•ng</td>
<td>[InUse, NotInUse, Expired, Depleted]</td>
</tr>
</tbody>
</table>
<h4 id="-v√≠-d·ª•-document-complete-7">üìÑ V√≠ d·ª• Document Complete </h4>
<pre data-role="codeBlock" data-info="json" class="language-json json"><code><span class="token punctuation">{</span>
  <span class="token property">"_id"</span><span class="token operator">:</span> ObjectId(<span class="token string">"64f123456789abcdef01234c"</span>)<span class="token punctuation">,</span>
  <span class="token property">"Reagent_ID"</span><span class="token operator">:</span> <span class="token string">"REA_SYS_CBC_202410_001"</span><span class="token punctuation">,</span> 
  <span class="token property">"Reagent_Name"</span><span class="token operator">:</span> <span class="token string">"Sysmex CBC reagent kit"</span><span class="token punctuation">,</span>
  <span class="token property">"Reagent_Type"</span><span class="token operator">:</span> <span class="token string">"Analysis Reagent"</span><span class="token punctuation">,</span>
  <span class="token property">"Part_Number"</span><span class="token operator">:</span> <span class="token string">"XN-991-001-SYS"</span><span class="token punctuation">,</span>
  <span class="token property">"Inventory_Info"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">"current_quantity"</span><span class="token operator">:</span> <span class="token number">755</span><span class="token punctuation">,</span>
    <span class="token property">"initial_quantity"</span><span class="token operator">:</span> <span class="token number">1000</span><span class="token punctuation">,</span>
    <span class="token property">"unit_measure"</span><span class="token operator">:</span> <span class="token string">"tests"</span><span class="token punctuation">,</span>
    <span class="token property">"quantity_used"</span><span class="token operator">:</span> <span class="token number">245</span><span class="token punctuation">,</span>
    <span class="token property">"usage_rate_per_day"</span><span class="token operator">:</span> <span class="token number">50</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token property">"Expiration_Info"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">"expiration_date"</span><span class="token operator">:</span> ISODate(<span class="token string">"2025-09-15T00:00:00.000Z"</span>)<span class="token punctuation">,</span>
    <span class="token property">"lot_number"</span><span class="token operator">:</span> <span class="token string">"LOT_202409_SYS_001"</span><span class="token punctuation">,</span>
    <span class="token property">"days_until_expiry"</span><span class="token operator">:</span> <span class="token number">343</span><span class="token punctuation">,</span>
    <span class="token property">"expiry_alert_threshold"</span><span class="token operator">:</span> <span class="token number">30</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token property">"Supplier_Info"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">"vendor_id"</span><span class="token operator">:</span> <span class="token string">"VENDOR_SYSMEX_VN"</span><span class="token punctuation">,</span>
    <span class="token property">"vendor_name"</span><span class="token operator">:</span> <span class="token string">"Sysmex Medical Vietnam"</span><span class="token punctuation">,</span>
    <span class="token property">"purchase_order"</span><span class="token operator">:</span> <span class="token string">"PO_2024_09_001"</span><span class="token punctuation">,</span>
    <span class="token property">"received_date"</span><span class="token operator">:</span> ISODate(<span class="token string">"2024-09-01T00:00:00.000Z"</span>)<span class="token punctuation">,</span>
    <span class="token property">"batch_certificate"</span><span class="token operator">:</span> <span class="token string">"CERT_202409_001"</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token property">"Storage_Conditions"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">"temperature_range"</span><span class="token operator">:</span> <span class="token string">"2-8¬∞C"</span><span class="token punctuation">,</span>
    <span class="token property">"humidity_max"</span><span class="token operator">:</span> <span class="token string">"85%"</span><span class="token punctuation">,</span>
    <span class="token property">"light_protection"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    <span class="token property">"storage_location"</span><span class="token operator">:</span> <span class="token string">"Reagent Fridge A-02"</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token property">"Status_Info"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">"is_active"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    <span class="token property">"in_use_status"</span><span class="token operator">:</span> <span class="token string">"InUse"</span><span class="token punctuation">,</span>
    <span class="token property">"quality_control_status"</span><span class="token operator">:</span> <span class="token string">"Passed"</span><span class="token punctuation">,</span>
    <span class="token property">"last_qc_date"</span><span class="token operator">:</span> ISODate(<span class="token string">"2024-10-01T00:00:00.000Z"</span>)
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token property">"Created_Date"</span><span class="token operator">:</span> ISODate(<span class="token string">"2024-09-01T08:00:00.000Z"</span>)<span class="token punctuation">,</span>
  <span class="token property">"Updated_Date"</span><span class="token operator">:</span> ISODate(<span class="token string">"2024-10-07T10:30:00.000Z"</span>)
<span class="token punctuation">}</span>
</code></pre><h4 id="-business-rules-cho-reagent">üîß Business Rules cho Reagent </h4>
<ul>
<li><strong>Expiry Management</strong>: C·∫£nh b√°o khi c√≤n 30 ng√†y h·∫øt h·∫°n</li>
<li><strong>Inventory Threshold</strong>: Alert khi Current_Quantity &lt; 20% Initial_Quantity</li>
<li><strong>Lot Traceability</strong>: Lot_Number b·∫Øt bu·ªôc cho compliance</li>
<li><strong>Storage Compliance</strong>: Ki·ªÉm tra storage conditions th∆∞·ªùng xuy√™n</li>
<li><strong>ID Format</strong>: <code>REA_{Vendor}_{Type}_{YYYYMM}_{Number}</code></li>
</ul>
<h3 id="42--collection-9-instrument_reagent-collection-instrument_reagents">4.2 üîó Collection 9: Instrument_Reagent (Collection: <code>instrument_reagents</code>) </h3>
<p><strong>üéØ M·ª•c ƒë√≠ch</strong>: Qu·∫£n l√Ω vi·ªác g√°n thu·ªëc th·ª≠ cho t·ª´ng thi·∫øt b·ªã v√† theo d√µi usage.</p>
<h4 id="schema-definition-8">Schema Definition </h4>
<table>
<thead>
<tr>
<th>Tr∆∞·ªùng</th>
<th>Ki·ªÉu d·ªØ li·ªáu</th>
<th>M√¥ t·∫£</th>
<th>Assignment Info</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Assignment_ID</strong></td>
<td>String (PK)</td>
<td>ID g√°n thu·ªëc th·ª≠</td>
<td>Auto-generated</td>
</tr>
<tr>
<td><strong>Instrument_ID</strong></td>
<td>String (FK)</td>
<td>Thi·∫øt b·ªã s·ª≠ d·ª•ng</td>
<td>References Instrument</td>
</tr>
<tr>
<td><strong>Reagent_ID</strong></td>
<td>String (FK)</td>
<td>Thu·ªëc th·ª≠ ƒë∆∞·ª£c g√°n</td>
<td>References Reagent</td>
</tr>
<tr>
<td>Installation_Date</td>
<td>DateTime</td>
<td>Ng√†y l·∫Øp ƒë·∫∑t</td>
<td>Required</td>
</tr>
<tr>
<td>Position_Slot</td>
<td>String</td>
<td>V·ªã tr√≠ slot tr√™n m√°y</td>
<td>Required</td>
</tr>
<tr>
<td>Status</td>
<td>Enum</td>
<td>Tr·∫°ng th√°i</td>
<td>[Installed, Removed, Expired, LowLevel]</td>
</tr>
<tr>
<td>Expected_Tests_Count</td>
<td>Number</td>
<td>S·ªë test d·ª± ki·∫øn</td>
<td>Based on reagent capacity</td>
</tr>
<tr>
<td>Actual_Tests_Count</td>
<td>Number</td>
<td>S·ªë test th·ª±c t·∫ø</td>
<td>Auto-increment</td>
</tr>
<tr>
<td>Low_Level_Threshold</td>
<td>Number</td>
<td>Ng∆∞·ª°ng b√°o thi·∫øu</td>
<td>Configurable</td>
</tr>
<tr>
<td>Sufficient_Level</td>
<td>Boolean</td>
<td>ƒê·ªß m·ª©c s·ª≠ d·ª•ng</td>
<td>Auto-calculated</td>
</tr>
</tbody>
</table>
<h4 id="-v√≠-d·ª•-document-complete-8">üìÑ V√≠ d·ª• Document Complete </h4>
<pre data-role="codeBlock" data-info="json" class="language-json json"><code><span class="token punctuation">{</span>
  <span class="token property">"_id"</span><span class="token operator">:</span> ObjectId(<span class="token string">"64f123456789abcdef01234d"</span>)<span class="token punctuation">,</span>
  <span class="token property">"Assignment_ID"</span><span class="token operator">:</span> <span class="token string">"ASG_INS001_REA001_20241007"</span><span class="token punctuation">,</span>
  <span class="token property">"Instrument_ID"</span><span class="token operator">:</span> <span class="token string">"INS_LAB1_XN1000_001"</span><span class="token punctuation">,</span>
  <span class="token property">"Reagent_ID"</span><span class="token operator">:</span> <span class="token string">"REA_SYS_CBC_202410_001"</span><span class="token punctuation">,</span>
  <span class="token property">"Installation_Info"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">"installation_date"</span><span class="token operator">:</span> ISODate(<span class="token string">"2024-10-07T08:00:00.000Z"</span>)<span class="token punctuation">,</span>
    <span class="token property">"position_slot"</span><span class="token operator">:</span> <span class="token string">"R1-A"</span><span class="token punctuation">,</span>
    <span class="token property">"installed_by"</span><span class="token operator">:</span> <span class="token string">"TECH_001"</span><span class="token punctuation">,</span>
    <span class="token property">"installation_verified"</span><span class="token operator">:</span> <span class="token boolean">true</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token property">"Usage_Tracking"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">"expected_tests_count"</span><span class="token operator">:</span> <span class="token number">1000</span><span class="token punctuation">,</span>
    <span class="token property">"actual_tests_count"</span><span class="token operator">:</span> <span class="token number">245</span><span class="token punctuation">,</span>
    <span class="token property">"remaining_tests"</span><span class="token operator">:</span> <span class="token number">755</span><span class="token punctuation">,</span>
    <span class="token property">"usage_rate_per_day"</span><span class="token operator">:</span> <span class="token number">50</span><span class="token punctuation">,</span>
    <span class="token property">"estimated_depletion_date"</span><span class="token operator">:</span> ISODate(<span class="token string">"2024-10-22T00:00:00.000Z"</span>)
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token property">"Status_Info"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">"status"</span><span class="token operator">:</span> <span class="token string">"Installed"</span><span class="token punctuation">,</span>
    <span class="token property">"low_level_threshold"</span><span class="token operator">:</span> <span class="token number">100</span><span class="token punctuation">,</span>
    <span class="token property">"sufficient_level"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    <span class="token property">"last_usage"</span><span class="token operator">:</span> ISODate(<span class="token string">"2024-10-07T10:30:00.000Z"</span>)
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token property">"Performance_Metrics"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">"efficiency_rate"</span><span class="token operator">:</span> <span class="token number">98.5</span><span class="token punctuation">,</span>
    <span class="token property">"error_count"</span><span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span>
    <span class="token property">"maintenance_due"</span><span class="token operator">:</span> <span class="token boolean">false</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token property">"Quality_Control"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">"qc_status"</span><span class="token operator">:</span> <span class="token string">"Passed"</span><span class="token punctuation">,</span>
    <span class="token property">"last_qc_check"</span><span class="token operator">:</span> ISODate(<span class="token string">"2024-10-07T07:30:00.000Z"</span>)<span class="token punctuation">,</span>
    <span class="token property">"next_qc_due"</span><span class="token operator">:</span> ISODate(<span class="token string">"2024-10-14T07:30:00.000Z"</span>)
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token property">"Created_Date"</span><span class="token operator">:</span> ISODate(<span class="token string">"2024-10-07T08:00:00.000Z"</span>)<span class="token punctuation">,</span>
  <span class="token property">"Updated_Date"</span><span class="token operator">:</span> ISODate(<span class="token string">"2024-10-07T10:50:00.000Z"</span>)
<span class="token punctuation">}</span>
</code></pre><h4 id="-business-rules-cho-instrument_reagent">üîß Business Rules cho Instrument_Reagent </h4>
<ul>
<li><strong>Position Validation</strong>: M·ªói slot ch·ªâ c√≥ 1 reagent active</li>
<li><strong>Sufficient_Level Calculation</strong>: Auto-update d·ª±a tr√™n actual vs threshold</li>
<li><strong>Usage Tracking</strong>: Auto-increment Actual_Tests_Count sau m·ªói test</li>
<li><strong>Status Management</strong>: Auto chuy·ªÉn "LowLevel" khi &lt; threshold</li>
<li><strong>ID Format</strong>: <code>ASG_{InstrumentID}_{ReagentID}_{YYYYMMDD}</code></li>
</ul>
<h3 id="43--collection-10-reagent_activity_log-collection-reagent_activity_logs">4.3 üìã Collection 10: Reagent_Activity_Log (Collection: <code>reagent_activity_logs</code>) </h3>
<p><strong>üéØ M·ª•c ƒë√≠ch</strong>: Audit trail cho t·∫•t c·∫£ ho·∫°t ƒë·ªông li√™n quan ƒë·∫øn thu·ªëc th·ª≠ v√† lifecycle management.</p>
<h4 id="schema-definition-9">Schema Definition </h4>
<table>
<thead>
<tr>
<th>Tr∆∞·ªùng</th>
<th>Ki·ªÉu d·ªØ li·ªáu</th>
<th>M√¥ t·∫£</th>
<th>Audit Purpose</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Activity_ID</strong></td>
<td>String (PK)</td>
<td>ID ho·∫°t ƒë·ªông</td>
<td>Auto-generated</td>
</tr>
<tr>
<td><strong>Reagent_ID</strong></td>
<td>String (FK)</td>
<td>Thu·ªëc th·ª≠</td>
<td>References Reagent</td>
</tr>
<tr>
<td><strong>Instrument_ID</strong></td>
<td>String (FK)</td>
<td>Thi·∫øt b·ªã li√™n quan</td>
<td>References Instrument</td>
</tr>
<tr>
<td>Activity_Type</td>
<td>Enum</td>
<td>Lo·∫°i ho·∫°t ƒë·ªông</td>
<td>[Install, Modify, Delete, Use, Replace]</td>
</tr>
<tr>
<td>User_Performed</td>
<td>String</td>
<td>Ng∆∞·ªùi th·ª±c hi·ªán</td>
<td>Required for manual actions</td>
</tr>
<tr>
<td>Timestamp</td>
<td>DateTime</td>
<td>Th·ªùi ƒëi·ªÉm ho·∫°t ƒë·ªông</td>
<td>Auto-generated</td>
</tr>
<tr>
<td>Previous_Quantity</td>
<td>Number</td>
<td>S·ªë l∆∞·ª£ng tr∆∞·ªõc</td>
<td>For quantity changes</td>
</tr>
<tr>
<td>New_Quantity</td>
<td>Number</td>
<td>S·ªë l∆∞·ª£ng sau</td>
<td>For quantity changes</td>
</tr>
<tr>
<td>Previous_Status</td>
<td>String</td>
<td>Tr·∫°ng th√°i tr∆∞·ªõc</td>
<td>For status changes</td>
</tr>
<tr>
<td>New_Status</td>
<td>String</td>
<td>Tr·∫°ng th√°i sau</td>
<td>For status changes</td>
</tr>
<tr>
<td>Lot_Number</td>
<td>String</td>
<td>S·ªë l√¥</td>
<td>For traceability</td>
</tr>
<tr>
<td>Notes</td>
<td>String</td>
<td>Ghi ch√∫ th√™m</td>
<td>Optional</td>
</tr>
</tbody>
</table>
<h4 id="-v√≠-d·ª•-document-complete-9">üìÑ V√≠ d·ª• Document Complete </h4>
<pre data-role="codeBlock" data-info="json" class="language-json json"><code><span class="token punctuation">{</span>
  <span class="token property">"_id"</span><span class="token operator">:</span> ObjectId(<span class="token string">"64f123456789abcdef01234e"</span>)<span class="token punctuation">,</span>
  <span class="token property">"Activity_ID"</span><span class="token operator">:</span> <span class="token string">"ACT_20241007_001"</span><span class="token punctuation">,</span>
  <span class="token property">"Reagent_ID"</span><span class="token operator">:</span> <span class="token string">"REA_SYS_CBC_202410_001"</span><span class="token punctuation">,</span>
  <span class="token property">"Instrument_ID"</span><span class="token operator">:</span> <span class="token string">"INS_LAB1_XN1000_001"</span><span class="token punctuation">,</span>
  <span class="token property">"Activity_Details"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">"activity_type"</span><span class="token operator">:</span> <span class="token string">"Use"</span><span class="token punctuation">,</span>
    <span class="token property">"user_performed"</span><span class="token operator">:</span> <span class="token string">"SYSTEM_AUTO"</span><span class="token punctuation">,</span>
    <span class="token property">"timestamp"</span><span class="token operator">:</span> ISODate(<span class="token string">"2024-10-07T10:30:00.000Z"</span>)
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token property">"Quantity_Changes"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">"previous_quantity"</span><span class="token operator">:</span> <span class="token number">755</span><span class="token punctuation">,</span>
    <span class="token property">"new_quantity"</span><span class="token operator">:</span> <span class="token number">750</span><span class="token punctuation">,</span>
    <span class="token property">"usage_amount"</span><span class="token operator">:</span> <span class="token number">5</span><span class="token punctuation">,</span>
    <span class="token property">"unit_measure"</span><span class="token operator">:</span> <span class="token string">"tests"</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token property">"Status_Changes"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">"previous_status"</span><span class="token operator">:</span> <span class="token string">"InUse"</span><span class="token punctuation">,</span>
    <span class="token property">"new_status"</span><span class="token operator">:</span> <span class="token string">"InUse"</span><span class="token punctuation">,</span>
    <span class="token property">"sufficient_level_before"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    <span class="token property">"sufficient_level_after"</span><span class="token operator">:</span> <span class="token boolean">true</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token property">"Test_Context"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">"test_order_id"</span><span class="token operator">:</span> <span class="token string">"ORD_2024_1007_0123"</span><span class="token punctuation">,</span>
    <span class="token property">"sample_barcode"</span><span class="token operator">:</span> <span class="token string">"SMP20241007001"</span><span class="token punctuation">,</span>
    <span class="token property">"test_type"</span><span class="token operator">:</span> <span class="token string">"CBC+Diff"</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token property">"Traceability_Info"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">"lot_number"</span><span class="token operator">:</span> <span class="token string">"LOT_202409_SYS_001"</span><span class="token punctuation">,</span>
    <span class="token property">"expiration_date"</span><span class="token operator">:</span> ISODate(<span class="token string">"2025-09-15T00:00:00.000Z"</span>)<span class="token punctuation">,</span>
    <span class="token property">"supplier_details"</span><span class="token operator">:</span> <span class="token string">"Sysmex Medical Vietnam"</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token property">"Performance_Metrics"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">"remaining_tests_estimated"</span><span class="token operator">:</span> <span class="token number">750</span><span class="token punctuation">,</span>
    <span class="token property">"daily_usage_rate"</span><span class="token operator">:</span> <span class="token number">50</span><span class="token punctuation">,</span>
    <span class="token property">"depletion_forecast"</span><span class="token operator">:</span> ISODate(<span class="token string">"2024-10-22T00:00:00.000Z"</span>)
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token property">"Notes"</span><span class="token operator">:</span> <span class="token string">"Automatic usage logging during CBC+Diff analysis"</span>
<span class="token punctuation">}</span>
</code></pre><h4 id="-business-rules-cho-reagent_activity_log">üîß Business Rules cho Reagent_Activity_Log </h4>
<ul>
<li><strong>Immutable</strong>: Audit logs kh√¥ng ƒë∆∞·ª£c s·ª≠a ƒë·ªïi sau khi t·∫°o</li>
<li><strong>Auto-Generation</strong>: T·ª± ƒë·ªông t·∫°o log cho m·ªçi thao t√°c on reagents</li>
<li><strong>Traceability</strong>: M·ªçi thao t√°c quan tr·ªçng ƒë·ªÅu ph·∫£i c√≥ audit trail</li>
<li><strong>Retention</strong>: Audit logs gi·ªØ vƒ©nh vi·ªÖn cho compliance</li>
<li><strong>ID Format</strong>: <code>ACT_{YYYYMMDD}_{SequenceNumber}</code></li>
</ul>
<hr>
<h2 id="5-configuration-management-collection-11-12">5. Configuration Management (Collection 11-12) </h2>
<h3 id="51-Ô∏è-collection-11-configuration_profile-collection-configuration_profiles">5.1 ‚öôÔ∏è Collection 11: Configuration_Profile (Collection: <code>configuration_profiles</code>) </h3>
<p><strong>üéØ M·ª•c ƒë√≠ch</strong>: L∆∞u tr·ªØ c√°c profile c·∫•u h√¨nh cho thi·∫øt b·ªã, h·ªó tr·ª£ c·∫£ c·∫•u h√¨nh to√†n c·ª•c v√† ƒë·∫∑c th√π.</p>
<h4 id="schema-definition-10">Schema Definition </h4>
<table>
<thead>
<tr>
<th>Tr∆∞·ªùng</th>
<th>Ki·ªÉu d·ªØ li·ªáu</th>
<th>M√¥ t·∫£</th>
<th>Configuration Types</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Profile_ID</strong></td>
<td>String (PK)</td>
<td>ID profile duy nh·∫•t</td>
<td>Auto-generated</td>
</tr>
<tr>
<td>Profile_Name</td>
<td>String</td>
<td>T√™n profile</td>
<td>Required, Max 100 chars</td>
</tr>
<tr>
<td>Profile_Type</td>
<td>Enum</td>
<td>Lo·∫°i profile</td>
<td>[General, Specific, Custom]</td>
</tr>
<tr>
<td>Configuration_Data</td>
<td>Object</td>
<td>D·ªØ li·ªáu c·∫•u h√¨nh</td>
<td>JSON format</td>
</tr>
<tr>
<td>Is_Global</td>
<td>Boolean</td>
<td>√Åp d·ª•ng to√†n c·ª•c</td>
<td>true for General type</td>
</tr>
<tr>
<td>Target_Model_ID</td>
<td>String</td>
<td>Model ƒë√≠ch (cho Specific)</td>
<td>Nullable for General</td>
</tr>
<tr>
<td>Target_Device_Type</td>
<td>String</td>
<td>Lo·∫°i thi·∫øt b·ªã ƒë√≠ch</td>
<td>Required</td>
</tr>
<tr>
<td>Version</td>
<td>String</td>
<td>Phi√™n b·∫£n c·∫•u h√¨nh</td>
<td>Semantic versioning</td>
</tr>
<tr>
<td>Firmware_Version</td>
<td>String</td>
<td>Phi√™n b·∫£n firmware t∆∞∆°ng th√≠ch</td>
<td>Required</td>
</tr>
<tr>
<td>Calibration_Settings</td>
<td>Object</td>
<td>C√†i ƒë·∫∑t hi·ªáu chu·∫©n</td>
<td>JSON format</td>
</tr>
<tr>
<td>Created_By</td>
<td>String</td>
<td>Ng∆∞·ªùi t·∫°o</td>
<td>Required</td>
</tr>
<tr>
<td>Is_Active</td>
<td>Boolean</td>
<td>ƒêang ho·∫°t ƒë·ªông</td>
<td>Default: true</td>
</tr>
</tbody>
</table>
<h4 id="-v√≠-d·ª•-document-complete-10">üìÑ V√≠ d·ª• Document Complete </h4>
<pre data-role="codeBlock" data-info="json" class="language-json json"><code><span class="token punctuation">{</span>
  <span class="token property">"_id"</span><span class="token operator">:</span> ObjectId(<span class="token string">"64f123456789abcdef01234f"</span>)<span class="token punctuation">,</span>
  <span class="token property">"Profile_ID"</span><span class="token operator">:</span> <span class="token string">"CFG_GENERAL_HEMATO_V2"</span><span class="token punctuation">,</span>
  <span class="token property">"Profile_Name"</span><span class="token operator">:</span> <span class="token string">"General Hematology Configuration v2.0"</span><span class="token punctuation">,</span>
  <span class="token property">"Profile_Type"</span><span class="token operator">:</span> <span class="token string">"General"</span><span class="token punctuation">,</span>
  <span class="token property">"Is_Global"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
  <span class="token property">"Target_Device_Type"</span><span class="token operator">:</span> <span class="token string">"Hematology Analyzer"</span><span class="token punctuation">,</span>
  <span class="token property">"Version"</span><span class="token operator">:</span> <span class="token string">"2.0.1"</span><span class="token punctuation">,</span>
  <span class="token property">"Firmware_Version"</span><span class="token operator">:</span> <span class="token string">"&gt;=2.1.0"</span><span class="token punctuation">,</span>
  <span class="token property">"Configuration_Data"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">"analysis_parameters"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token property">"sample_volume"</span><span class="token operator">:</span> <span class="token number">88</span><span class="token punctuation">,</span>
      <span class="token property">"dilution_ratio"</span><span class="token operator">:</span> <span class="token string">"1:200"</span><span class="token punctuation">,</span>
      <span class="token property">"analysis_time"</span><span class="token operator">:</span> <span class="token number">60</span><span class="token punctuation">,</span>
      <span class="token property">"temperature"</span><span class="token operator">:</span> <span class="token number">37</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token property">"quality_control"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token property">"qc_frequency"</span><span class="token operator">:</span> <span class="token string">"daily"</span><span class="token punctuation">,</span>
      <span class="token property">"control_levels"</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">"Level1"</span><span class="token punctuation">,</span> <span class="token string">"Level2"</span><span class="token punctuation">,</span> <span class="token string">"Level3"</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
      <span class="token property">"acceptable_cv"</span><span class="token operator">:</span> <span class="token number">2.0</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token property">"alert_thresholds"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token property">"critical_low"</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token property">"wbc"</span><span class="token operator">:</span> <span class="token number">1.0</span><span class="token punctuation">,</span> <span class="token property">"rbc"</span><span class="token operator">:</span> <span class="token number">2.0</span><span class="token punctuation">,</span> <span class="token property">"plt"</span><span class="token operator">:</span> <span class="token number">20</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token property">"critical_high"</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token property">"wbc"</span><span class="token operator">:</span> <span class="token number">50.0</span><span class="token punctuation">,</span> <span class="token property">"rbc"</span><span class="token operator">:</span> <span class="token number">7.0</span><span class="token punctuation">,</span> <span class="token property">"plt"</span><span class="token operator">:</span> <span class="token number">1000</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token property">"delta_check"</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token property">"wbc"</span><span class="token operator">:</span> <span class="token number">30</span><span class="token punctuation">,</span> <span class="token property">"rbc"</span><span class="token operator">:</span> <span class="token number">20</span><span class="token punctuation">,</span> <span class="token property">"plt"</span><span class="token operator">:</span> <span class="token number">40</span><span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token property">"Calibration_Settings"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">"calibration_frequency"</span><span class="token operator">:</span> <span class="token number">30</span><span class="token punctuation">,</span>
    <span class="token property">"calibrator_type"</span><span class="token operator">:</span> <span class="token string">"Sysmex e-CHECK"</span><span class="token punctuation">,</span>
    <span class="token property">"linearity_check"</span><span class="token operator">:</span> <span class="token string">"monthly"</span><span class="token punctuation">,</span>
    <span class="token property">"carryover_check"</span><span class="token operator">:</span> <span class="token string">"weekly"</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token property">"Maintenance_Config"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">"daily_maintenance"</span><span class="token operator">:</span> <span class="token string">"auto"</span><span class="token punctuation">,</span>
    <span class="token property">"weekly_maintenance"</span><span class="token operator">:</span> <span class="token string">"manual"</span><span class="token punctuation">,</span>
    <span class="token property">"reagent_monitoring"</span><span class="token operator">:</span> <span class="token string">"continuous"</span><span class="token punctuation">,</span>
    <span class="token property">"background_check"</span><span class="token operator">:</span> <span class="token string">"startup"</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token property">"Created_By"</span><span class="token operator">:</span> <span class="token string">"ADMIN_CONFIG"</span><span class="token punctuation">,</span>
  <span class="token property">"Created_Date"</span><span class="token operator">:</span> ISODate(<span class="token string">"2024-01-15T00:00:00.000Z"</span>)<span class="token punctuation">,</span>
  <span class="token property">"Updated_Date"</span><span class="token operator">:</span> ISODate(<span class="token string">"2024-10-07T00:00:00.000Z"</span>)<span class="token punctuation">,</span>
  <span class="token property">"Is_Active"</span><span class="token operator">:</span> <span class="token boolean">true</span>
<span class="token punctuation">}</span>
</code></pre><h4 id="-business-rules-cho-configuration_profile">üîß Business Rules cho Configuration_Profile </h4>
<ul>
<li><strong>Version Control</strong>: Version ph·∫£i theo semantic versioning</li>
<li><strong>Global Constraint</strong>: Is_Global = true ch·ªâ cho Profile_Type = "General"</li>
<li><strong>Firmware Compatibility</strong>: Ki·ªÉm tra firmware version compatibility</li>
<li><strong>Validation</strong>: Configuration_Data ph·∫£i validate tr∆∞·ªõc khi save</li>
<li><strong>ID Format</strong>: <code>CFG_{Type}_{DeviceType}_{Version}</code></li>
</ul>
<h3 id="52--collection-12-configuration_sync_log-collection-configuration_sync_logs">5.2 üîÑ Collection 12: Configuration_Sync_Log (Collection: <code>configuration_sync_logs</code>) </h3>
<p><strong>üéØ M·ª•c ƒë√≠ch</strong>: Theo d√µi vi·ªác ƒë·ªìng b·ªô c·∫•u h√¨nh t·ª´ profile xu·ªëng thi·∫øt b·ªã v√† error handling.</p>
<h4 id="schema-definition-11">Schema Definition </h4>
<table>
<thead>
<tr>
<th>Tr∆∞·ªùng</th>
<th>Ki·ªÉu d·ªØ li·ªáu</th>
<th>M√¥ t·∫£</th>
<th>Sync Tracking</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Sync_Log_ID</strong></td>
<td>String (PK)</td>
<td>ID log ƒë·ªìng b·ªô</td>
<td>Auto-generated</td>
</tr>
<tr>
<td><strong>Instrument_ID</strong></td>
<td>String (FK)</td>
<td>Thi·∫øt b·ªã ƒë·ªìng b·ªô</td>
<td>References Instrument</td>
</tr>
<tr>
<td><strong>Profile_ID</strong></td>
<td>String (FK)</td>
<td>Profile ƒë∆∞·ª£c √°p d·ª•ng</td>
<td>References Configuration_Profile</td>
</tr>
<tr>
<td>User_Performed</td>
<td>String</td>
<td>Ng∆∞·ªùi th·ª±c hi·ªán</td>
<td>Required</td>
</tr>
<tr>
<td>Sync_Timestamp</td>
<td>DateTime</td>
<td>Th·ªùi ƒëi·ªÉm ƒë·ªìng b·ªô</td>
<td>Auto-generated</td>
</tr>
<tr>
<td>Sync_Type</td>
<td>Enum</td>
<td>Lo·∫°i ƒë·ªìng b·ªô</td>
<td>[General, Specific, Both]</td>
</tr>
<tr>
<td>Sync_Status</td>
<td>Enum</td>
<td>Tr·∫°ng th√°i ƒë·ªìng b·ªô</td>
<td>[Success, Failed, Partial]</td>
</tr>
<tr>
<td>Error_Details</td>
<td>String</td>
<td>Chi ti·∫øt l·ªói</td>
<td>For failed syncs</td>
</tr>
<tr>
<td>Configuration_Hash</td>
<td>String</td>
<td>Hash c·ªßa config</td>
<td>For validation</td>
</tr>
<tr>
<td>Rollback_Data</td>
<td>Object</td>
<td>D·ªØ li·ªáu rollback</td>
<td>For recovery</td>
</tr>
<tr>
<td>Processing_Time_MS</td>
<td>Number</td>
<td>Th·ªùi gian x·ª≠ l√Ω</td>
<td>Performance metric</td>
</tr>
</tbody>
</table>
<h4 id="-v√≠-d·ª•-document-complete-11">üìÑ V√≠ d·ª• Document Complete </h4>
<pre data-role="codeBlock" data-info="json" class="language-json json"><code><span class="token punctuation">{</span>
  <span class="token property">"_id"</span><span class="token operator">:</span> ObjectId(<span class="token string">"64f123456789abcdef012350"</span>)<span class="token punctuation">,</span>
  <span class="token property">"Sync_Log_ID"</span><span class="token operator">:</span> <span class="token string">"SYNC_20241007_001"</span><span class="token punctuation">,</span>
  <span class="token property">"Instrument_ID"</span><span class="token operator">:</span> <span class="token string">"INS_LAB1_XN1000_001"</span><span class="token punctuation">,</span>
  <span class="token property">"Profile_ID"</span><span class="token operator">:</span> <span class="token string">"CFG_GENERAL_HEMATO_V2"</span><span class="token punctuation">,</span>
  <span class="token property">"Sync_Details"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">"user_performed"</span><span class="token operator">:</span> <span class="token string">"TECH_SUPERVISOR_001"</span><span class="token punctuation">,</span>
    <span class="token property">"sync_timestamp"</span><span class="token operator">:</span> ISODate(<span class="token string">"2024-10-07T08:00:00.000Z"</span>)<span class="token punctuation">,</span>
    <span class="token property">"sync_type"</span><span class="token operator">:</span> <span class="token string">"General"</span><span class="token punctuation">,</span>
    <span class="token property">"sync_status"</span><span class="token operator">:</span> <span class="token string">"Success"</span><span class="token punctuation">,</span>
    <span class="token property">"processing_time_ms"</span><span class="token operator">:</span> <span class="token number">2340</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token property">"Configuration_Info"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">"configuration_hash"</span><span class="token operator">:</span> <span class="token string">"sha256:a1b2c3d4e5f6..."</span><span class="token punctuation">,</span>
    <span class="token property">"config_version"</span><span class="token operator">:</span> <span class="token string">"2.0.1"</span><span class="token punctuation">,</span>
    <span class="token property">"firmware_compatibility"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    <span class="token property">"validation_passed"</span><span class="token operator">:</span> <span class="token boolean">true</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token property">"Applied_Settings"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">"general_config_applied"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    <span class="token property">"specific_config_applied"</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
    <span class="token property">"calibration_settings_updated"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    <span class="token property">"qc_parameters_updated"</span><span class="token operator">:</span> <span class="token boolean">true</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token property">"Rollback_Data"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">"previous_config_hash"</span><span class="token operator">:</span> <span class="token string">"sha256:f6e5d4c3b2a1..."</span><span class="token punctuation">,</span>
    <span class="token property">"rollback_available"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    <span class="token property">"backup_timestamp"</span><span class="token operator">:</span> ISODate(<span class="token string">"2024-10-07T07:59:30.000Z"</span>)
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token property">"Validation_Results"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">"device_type_validated"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    <span class="token property">"firmware_version_check"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    <span class="token property">"parameter_range_check"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    <span class="token property">"dependency_check"</span><span class="token operator">:</span> <span class="token boolean">true</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token property">"Performance_Metrics"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">"config_download_time_ms"</span><span class="token operator">:</span> <span class="token number">450</span><span class="token punctuation">,</span>
    <span class="token property">"validation_time_ms"</span><span class="token operator">:</span> <span class="token number">890</span><span class="token punctuation">,</span>
    <span class="token property">"application_time_ms"</span><span class="token operator">:</span> <span class="token number">1000</span><span class="token punctuation">,</span>
    <span class="token property">"total_processing_time_ms"</span><span class="token operator">:</span> <span class="token number">2340</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><h4 id="-business-rules-cho-configuration_sync_log">üîß Business Rules cho Configuration_Sync_Log </h4>
<ul>
<li><strong>Pre-Sync Validation</strong>: Validate firmware compatibility tr∆∞·ªõc khi sync</li>
<li><strong>Rollback Capability</strong>: L∆∞u tr·ªØ rollback data cho m·ªçi sync</li>
<li><strong>Hash Verification</strong>: Verify config integrity qua hash comparison</li>
<li><strong>Error Recovery</strong>: Auto rollback n·∫øu sync failed</li>
<li><strong>ID Format</strong>: <code>SYNC_{YYYYMMDD}_{SequenceNumber}</code></li>
</ul>
<hr>
<h2 id="6-relationships--business-rules">6. Relationships &amp; Business Rules </h2>
<h3 id="-entity-relationships">üîó Entity Relationships </h3>
<h4 id="primary-relationships">Primary Relationships </h4>
<pre data-role="codeBlock" data-info="" class="language-text"><code>Instrument_Model (1) -----&gt; (*) Instrument
Instrument (1) -----&gt; (*) Instrument_Mode_Change_Log
Instrument (1) -----&gt; (*) Raw_Test_Result
Instrument (1) -----&gt; (*) Auto_Test_Order_Creation
Instrument (1) -----&gt; (*) Instrument_Reagent
Instrument (1) -----&gt; (*) Configuration_Sync_Log

Raw_Test_Result (1) -----&gt; (*) HL7_Publish_Log
Raw_Test_Result (1) -----&gt; (0..1) Raw_Result_Deletion_Log

Reagent (1) -----&gt; (*) Instrument_Reagent
Reagent (1) -----&gt; (*) Reagent_Activity_Log
Instrument_Reagent (1) -----&gt; (*) Reagent_Activity_Log

Configuration_Profile (1) -----&gt; (*) Configuration_Sync_Log
</code></pre><h3 id="-critical-business-rules">üîß Critical Business Rules </h3>
<h4 id="data-integrity-rules">Data Integrity Rules </h4>
<ol>
<li><strong>Cascading Deletes</strong>: Kh√¥ng cho ph√©p x√≥a Instrument khi c√≥ Raw_Test_Result active</li>
<li><strong>Foreign Key Constraints</strong>: T·∫•t c·∫£ FK ph·∫£i valid tr∆∞·ªõc khi insert</li>
<li><strong>Audit Trail</strong>: M·ªçi thay ƒë·ªïi quan tr·ªçng ph·∫£i c√≥ audit log</li>
</ol>
<h4 id="operational-rules">Operational Rules </h4>
<ol>
<li><strong>Mode Change</strong>: Instrument ch·ªâ c√≥ th·ªÉ Ready khi QC_Status = "Passed"</li>
<li><strong>Reagent Usage</strong>: Kh√¥ng cho ph√©p start test khi Sufficient_Level = false</li>
<li><strong>Configuration Sync</strong>: Ph·∫£i validate firmware compatibility tr∆∞·ªõc sync</li>
</ol>
<h4 id="compliance-rules">Compliance Rules </h4>
<ol>
<li><strong>Data Retention</strong>: Raw data gi·ªØ t·ªëi thi·ªÉu 7 ng√†y sau backup</li>
<li><strong>Audit Logs</strong>: Audit logs kh√¥ng ƒë∆∞·ª£c x√≥a ho·∫∑c modify</li>
<li><strong>Traceability</strong>: M·ªçi sample ph·∫£i c√≥ full traceability chain</li>
</ol>
<hr>

      </div>
      
      
    
    
    
    
    
    
  
    </body></html>